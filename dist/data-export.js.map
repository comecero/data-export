{"version":3,"names":[],"mappings":"","sources":["data-export.js"],"sourcesContent":["// 2.2.1\nangular.module(\"gettext\", []), angular.module(\"gettext\").constant(\"gettext\", function (a) { return a }), angular.module(\"gettext\").factory(\"gettextCatalog\", [\"gettextPlurals\", \"gettextFallbackLanguage\", \"$http\", \"$cacheFactory\", \"$interpolate\", \"$rootScope\", function (a, b, c, d, e, f) { function g() { f.$broadcast(\"gettextLanguageChanged\") } var h, i = \"$$noContext\", j = '<span id=\"test\" title=\"test\" class=\"tested\">test</span>', k = angular.element(\"<span>\" + j + \"</span>\").html() !== j, l = function (a) { return h.debug && h.currentLanguage !== h.baseLanguage?h.debugPrefix + a:a }, m = function (a) { return h.showTranslatedMarkers?h.translatedMarkerPrefix + a + h.translatedMarkerSuffix:a }; return h = { debug: !1, debugPrefix: \"[MISSING]: \", showTranslatedMarkers: !1, translatedMarkerPrefix: \"[\", translatedMarkerSuffix: \"]\", strings: {}, baseLanguage: \"en\", currentLanguage: \"en\", cache: d(\"strings\"), setCurrentLanguage: function (a) { this.currentLanguage = a, g() }, getCurrentLanguage: function () { return this.currentLanguage }, setStrings: function (a, b) { this.strings[a] || (this.strings[a] = {}); for (var c in b) { var d = b[c]; if (k && (c = angular.element(\"<span>\" + c + \"</span>\").html()), angular.isString(d) || angular.isArray(d)) { var e = {}; e[i] = d, d = e } for (var f in d) { var h = d[f]; d[f] = angular.isArray(h)?h:[h] } this.strings[a][c] = d } g() }, getStringFormFor: function (b, c, d, e) { if (!b) return null; var f = this.strings[b] || {}, g = f[c] || {}, h = g[e || i] || []; return h[a(b, d)] }, getString: function (a, c, d) { var f = b(this.currentLanguage); return a = this.getStringFormFor(this.currentLanguage, a, 1, d) || this.getStringFormFor(f, a, 1, d) || l(a), a = c?e(a)(c):a, m(a) }, getPlural: function (a, c, d, f, g) { var h = b(this.currentLanguage); return c = this.getStringFormFor(this.currentLanguage, c, a, g) || this.getStringFormFor(h, c, a, g) || l(1 === a?c:d), f && (f.$count = a, c = e(c)(f)), m(c) }, loadRemote: function (a) { return c({ method: \"GET\", url: a, cache: h.cache }).then(function (a) { var b = a.data; for (var c in b) h.setStrings(c, b[c]); return a }) } } }]), angular.module(\"gettext\").directive(\"translate\", [\"gettextCatalog\", \"$parse\", \"$animate\", \"$compile\", \"$window\", function (a, b, c, d, e) { function f(a, b, c) { if (!a) throw new Error(\"You should add a \" + b + \" attribute whenever you add a \" + c + \" attribute.\") } var g = function () { return String.prototype.trim?function (a) { return \"string\" == typeof a?a.trim():a }:function (a) { return \"string\" == typeof a?a.replace(/^\\s*/, \"\").replace(/\\s*$/, \"\"):a } }(), h = parseInt((/msie (\\d+)/.exec(angular.lowercase(e.navigator.userAgent)) || [])[1], 10); return { restrict: \"AE\", terminal: !0, compile: function (e, i) { f(!i.translatePlural || i.translateN, \"translate-n\", \"translate-plural\"), f(!i.translateN || i.translatePlural, \"translate-plural\", \"translate-n\"); var j = g(e.html()), k = i.translatePlural, l = i.translateContext; return 8 >= h && \"<!--IE fix-->\" === j.slice(-13) && (j = j.slice(0, -13)), { post: function (e, f, h) { function i() { var b; k?(e = n || (n = e.$new()), e.$count = m(e), b = a.getPlural(e.$count, j, k, null, l)):b = a.getString(j, null, l); var h = f.contents(); if (0 !== h.length) { if (b === g(h.html())) return void (o && d(h)(e)); var i = angular.element(\"<span>\" + b + \"</span>\"); d(i.contents())(e); var p = i.contents(); c.enter(p, f), c.leave(h) } } var m = b(h.translateN), n = null, o = !0; h.translateN && e.$watch(h.translateN, i), e.$on(\"gettextLanguageChanged\", i), i(), o = !1 } } } } }]), angular.module(\"gettext\").factory(\"gettextFallbackLanguage\", function () { var a = {}, b = /([^_]+)_[^_]+$/; return function (c) { if (a[c]) return a[c]; var d = b.exec(c); return d?(a[c] = d[1], d[1]):null } }), angular.module(\"gettext\").filter(\"translate\", [\"gettextCatalog\", function (a) { function b(b, c) { return a.getString(b, null, c) } return b.$stateful = !0, b }]), angular.module(\"gettext\").factory(\"gettextPlurals\", function () { return function (a, b) { switch (a) {case \"ay\":case \"bo\":case \"cgg\":case \"dz\":case \"fa\":case \"id\":case \"ja\":case \"jbo\":case \"ka\":case \"kk\":case \"km\":case \"ko\":case \"ky\":case \"lo\":case \"ms\":case \"my\":case \"sah\":case \"su\":case \"th\":case \"tt\":case \"ug\":case \"vi\":case \"wo\":case \"zh\": return 0;case \"is\": return b % 10 != 1 || b % 100 == 11?1:0;case \"jv\": return 0 != b?1:0;case \"mk\": return 1 == b || b % 10 == 1?0:1;case \"ach\":case \"ak\":case \"am\":case \"arn\":case \"br\":case \"fil\":case \"fr\":case \"gun\":case \"ln\":case \"mfe\":case \"mg\":case \"mi\":case \"oc\":case \"pt_BR\":case \"tg\":case \"ti\":case \"tr\":case \"uz\":case \"wa\":case \"zh\": return b > 1?1:0;case \"lv\": return b % 10 == 1 && b % 100 != 11?0:0 != b?1:2;case \"lt\": return b % 10 == 1 && b % 100 != 11?0:b % 10 >= 2 && (10 > b % 100 || b % 100 >= 20)?1:2;case \"be\":case \"bs\":case \"hr\":case \"ru\":case \"sr\":case \"uk\": return b % 10 == 1 && b % 100 != 11?0:b % 10 >= 2 && 4 >= b % 10 && (10 > b % 100 || b % 100 >= 20)?1:2;case \"mnk\": return 0 == b?0:1 == b?1:2;case \"ro\": return 1 == b?0:0 == b || b % 100 > 0 && 20 > b % 100?1:2;case \"pl\": return 1 == b?0:b % 10 >= 2 && 4 >= b % 10 && (10 > b % 100 || b % 100 >= 20)?1:2;case \"cs\":case \"sk\": return 1 == b?0:b >= 2 && 4 >= b?1:2;case \"sl\": return b % 100 == 1?1:b % 100 == 2?2:b % 100 == 3 || b % 100 == 4?3:0;case \"mt\": return 1 == b?0:0 == b || b % 100 > 1 && 11 > b % 100?1:b % 100 > 10 && 20 > b % 100?2:3;case \"gd\": return 1 == b || 11 == b?0:2 == b || 12 == b?1:b > 2 && 20 > b?2:3;case \"cy\": return 1 == b?0:2 == b?1:8 != b && 11 != b?2:3;case \"kw\": return 1 == b?0:2 == b?1:3 == b?2:3;case \"ga\": return 1 == b?0:2 == b?1:7 > b?2:11 > b?3:4;case \"ar\": return 0 == b?0:1 == b?1:2 == b?2:b % 100 >= 3 && 10 >= b % 100?3:b % 100 >= 11?4:5;default: return 1 != b?1:0} } });\n// https://github.com/oblador/angular-scroll\nvar duScrollDefaultEasing = function (e) { \"use strict\"; return .5 > e ? Math.pow(2 * e, 2) / 2 : 1 - Math.pow(2 * (1 - e), 2) / 2 }; angular.module(\"duScroll\", [\"duScroll.scrollspy\", \"duScroll.smoothScroll\", \"duScroll.scrollContainer\", \"duScroll.spyContext\", \"duScroll.scrollHelpers\"]).value(\"duScrollDuration\", 350).value(\"duScrollSpyWait\", 100).value(\"duScrollGreedy\", !1).value(\"duScrollOffset\", 0).value(\"duScrollEasing\", duScrollDefaultEasing).value(\"duScrollCancelOnEvents\", \"scroll mousedown mousewheel touchmove keydown\").value(\"duScrollBottomSpy\", !1).value(\"duScrollActiveClass\", \"active\"), angular.module(\"duScroll.scrollHelpers\", [\"duScroll.requestAnimation\"]).run([\"$window\", \"$q\", \"cancelAnimation\", \"requestAnimation\", \"duScrollEasing\", \"duScrollDuration\", \"duScrollOffset\", \"duScrollCancelOnEvents\", function (e, t, n, r, o, l, u, i) { \"use strict\"; var c = {}, a = function (e) { return \"undefined\" != typeof HTMLDocument && e instanceof HTMLDocument || e.nodeType && e.nodeType === e.DOCUMENT_NODE }, s = function (e) { return \"undefined\" != typeof HTMLElement && e instanceof HTMLElement || e.nodeType && e.nodeType === e.ELEMENT_NODE }, d = function (e) { return s(e) || a(e) ? e : e[0] }; c.duScrollTo = function (t, n, r, o) { var l; if (angular.isElement(t) ? l = this.duScrollToElement : angular.isDefined(r) && (l = this.duScrollToAnimated), l) return l.apply(this, arguments); var u = d(this); return a(u) ? e.scrollTo(t, n) : (u.scrollLeft = t, void (u.scrollTop = n)) }; var f, p; c.duScrollToAnimated = function (e, l, u, c) { u && !c && (c = o); var a = this.duScrollLeft(), s = this.duScrollTop(), d = Math.round(e - a), m = Math.round(l - s), S = null, g = 0, h = this, v = function (e) { (!e || g && e.which > 0) && (i && h.unbind(i, v), n(f), p.reject(), f = null) }; if (f && v(), p = t.defer(), 0 === u || !d && !m) return 0 === u && h.duScrollTo(e, l), p.resolve(), p.promise; var y = function (e) { null === S && (S = e), g = e - S; var t = g >= u ? 1 : c(g / u); h.scrollTo(a + Math.ceil(d * t), s + Math.ceil(m * t)), 1 > t ? f = r(y) : (i && h.unbind(i, v), f = null, p.resolve()) }; return h.duScrollTo(a, s), i && h.bind(i, v), f = r(y), p.promise }, c.duScrollToElement = function (e, t, n, r) { var o = d(this); (!angular.isNumber(t) || isNaN(t)) && (t = u); var l = this.duScrollTop() + d(e).getBoundingClientRect().top - t; return s(o) && (l -= o.getBoundingClientRect().top), this.duScrollTo(0, l, n, r) }, c.duScrollLeft = function (t, n, r) { if (angular.isNumber(t)) return this.duScrollTo(t, this.duScrollTop(), n, r); var o = d(this); return a(o) ? e.scrollX || document.documentElement.scrollLeft || document.body.scrollLeft : o.scrollLeft }, c.duScrollTop = function (t, n, r) { if (angular.isNumber(t)) return this.duScrollTo(this.duScrollLeft(), t, n, r); var o = d(this); return a(o) ? e.scrollY || document.documentElement.scrollTop || document.body.scrollTop : o.scrollTop }, c.duScrollToElementAnimated = function (e, t, n, r) { return this.duScrollToElement(e, t, n || l, r) }, c.duScrollTopAnimated = function (e, t, n) { return this.duScrollTop(e, t || l, n) }, c.duScrollLeftAnimated = function (e, t, n) { return this.duScrollLeft(e, t || l, n) }, angular.forEach(c, function (e, t) { angular.element.prototype[t] = e; var n = t.replace(/^duScroll/, \"scroll\"); angular.isUndefined(angular.element.prototype[n]) && (angular.element.prototype[n] = e) }) }]), angular.module(\"duScroll.polyfill\", []).factory(\"polyfill\", [\"$window\", function (e) { \"use strict\"; var t = [\"webkit\", \"moz\", \"o\", \"ms\"]; return function (n, r) { if (e[n]) return e[n]; for (var o, l = n.substr(0, 1).toUpperCase() + n.substr(1), u = 0; u < t.length; u++) if (o = t[u] + l, e[o]) return e[o]; return r } }]), angular.module(\"duScroll.requestAnimation\", [\"duScroll.polyfill\"]).factory(\"requestAnimation\", [\"polyfill\", \"$timeout\", function (e, t) { \"use strict\"; var n = 0, r = function (e, r) { var o = (new Date).getTime(), l = Math.max(0, 16 - (o - n)), u = t(function () { e(o + l) }, l); return n = o + l, u }; return e(\"requestAnimationFrame\", r) }]).factory(\"cancelAnimation\", [\"polyfill\", \"$timeout\", function (e, t) { \"use strict\"; var n = function (e) { t.cancel(e) }; return e(\"cancelAnimationFrame\", n) }]), angular.module(\"duScroll.spyAPI\", [\"duScroll.scrollContainerAPI\"]).factory(\"spyAPI\", [\"$rootScope\", \"$timeout\", \"$window\", \"$document\", \"scrollContainerAPI\", \"duScrollGreedy\", \"duScrollSpyWait\", \"duScrollBottomSpy\", \"duScrollActiveClass\", function (e, t, n, r, o, l, u, i, c) { \"use strict\"; var a = function (o) { var a = !1, s = !1, d = function () { s = !1; var t, u = o.container, a = u[0], d = 0; \"undefined\" != typeof HTMLElement && a instanceof HTMLElement || a.nodeType && a.nodeType === a.ELEMENT_NODE ? (d = a.getBoundingClientRect().top, t = Math.round(a.scrollTop + a.clientHeight) >= a.scrollHeight) : t = Math.round(n.pageYOffset + n.innerHeight) >= r[0].body.scrollHeight; var f, p, m, S, g, h, v = i && t ? \"bottom\" : \"top\"; for (S = o.spies, p = o.currentlyActive, m = void 0, f = 0; f < S.length; f++) g = S[f], h = g.getTargetPosition(), h && (i && t || h.top + g.offset - d < 20 && (l || -1 * h.top + d) < h.height) && (!m || m[v] < h[v]) && (m = { spy: g }, m[v] = h[v]); m && (m = m.spy), p === m || l && !m || (p && (p.$element.removeClass(c), e.$broadcast(\"duScrollspy:becameInactive\", p.$element, angular.element(p.getTargetElement()))), m && (m.$element.addClass(c), e.$broadcast(\"duScrollspy:becameActive\", m.$element, angular.element(m.getTargetElement()))), o.currentlyActive = m) }; return u ? function () { a ? s = !0 : (d(), a = t(function () { a = !1, s && d() }, u, !1)) } : d }, s = {}, d = function (e) { var t = e.$id, n = { spies: [] }; return n.handler = a(n), s[t] = n, e.$on(\"$destroy\", function () { f(e) }), t }, f = function (e) { var t = e.$id, n = s[t], r = n.container; r && r.off(\"scroll\", n.handler), delete s[t] }, p = d(e), m = function (e) { return s[e.$id] ? s[e.$id] : e.$parent ? m(e.$parent) : s[p] }, S = function (e) { var t, n, r = e.$scope; if (r) return m(r); for (n in s) if (t = s[n], -1 !== t.spies.indexOf(e)) return t }, g = function (e) { for (; e.parentNode;) if (e = e.parentNode, e === document) return !0; return !1 }, h = function (e) { var t = S(e); t && (t.spies.push(e), t.container && g(t.container) || (t.container && t.container.off(\"scroll\", t.handler), t.container = o.getContainer(e.$scope), t.container.on(\"scroll\", t.handler).triggerHandler(\"scroll\"))) }, v = function (e) { var t = S(e); e === t.currentlyActive && (t.currentlyActive = null); var n = t.spies.indexOf(e); -1 !== n && t.spies.splice(n, 1), e.$element = null }; return { addSpy: h, removeSpy: v, createContext: d, destroyContext: f, getContextForScope: m } }]), angular.module(\"duScroll.scrollContainerAPI\", []).factory(\"scrollContainerAPI\", [\"$document\", function (e) { \"use strict\"; var t = {}, n = function (e, n) { var r = e.$id; return t[r] = n, r }, r = function (e) { return t[e.$id] ? e.$id : e.$parent ? r(e.$parent) : void 0 }, o = function (n) { var o = r(n); return o ? t[o] : e }, l = function (e) { var n = r(e); n && delete t[n] }; return { getContainerId: r, getContainer: o, setContainer: n, removeContainer: l } }]), angular.module(\"duScroll.smoothScroll\", [\"duScroll.scrollHelpers\", \"duScroll.scrollContainerAPI\"]).directive(\"duSmoothScroll\", [\"duScrollDuration\", \"duScrollOffset\", \"scrollContainerAPI\", function (e, t, n) { \"use strict\"; return { link: function (r, o, l) { o.on(\"click\", function (o) { if (l.href && -1 !== l.href.indexOf(\"#\") || \"\" !== l.duSmoothScroll) { var u = l.href ? l.href.replace(/.*(?=#[^\\s]+$)/, \"\").substring(1) : l.duSmoothScroll, i = document.getElementById(u) || document.getElementsByName(u)[0]; if (i && i.getBoundingClientRect) { o.stopPropagation && o.stopPropagation(), o.preventDefault && o.preventDefault(); var c = l.offset ? parseInt(l.offset, 10) : t, a = l.duration ? parseInt(l.duration, 10) : e, s = n.getContainer(r); s.duScrollToElement(angular.element(i), isNaN(c) ? 0 : c, isNaN(a) ? 0 : a) } } }) } } }]), angular.module(\"duScroll.spyContext\", [\"duScroll.spyAPI\"]).directive(\"duSpyContext\", [\"spyAPI\", function (e) { \"use strict\"; return { restrict: \"A\", scope: !0, compile: function (t, n, r) { return { pre: function (t, n, r, o) { e.createContext(t) } } } } }]), angular.module(\"duScroll.scrollContainer\", [\"duScroll.scrollContainerAPI\"]).directive(\"duScrollContainer\", [\"scrollContainerAPI\", function (e) { \"use strict\"; return { restrict: \"A\", scope: !0, compile: function (t, n, r) { return { pre: function (t, n, r, o) { r.$observe(\"duScrollContainer\", function (r) { angular.isString(r) && (r = document.getElementById(r)), r = angular.isElement(r) ? angular.element(r) : n, e.setContainer(t, r), t.$on(\"$destroy\", function () { e.removeContainer(t) }) }) } } } } }]), angular.module(\"duScroll.scrollspy\", [\"duScroll.spyAPI\"]).directive(\"duScrollspy\", [\"spyAPI\", \"duScrollOffset\", \"$timeout\", \"$rootScope\", function (e, t, n, r) { \"use strict\"; var o = function (e, t, n, r) { angular.isElement(e) ? this.target = e : angular.isString(e) && (this.targetId = e), this.$scope = t, this.$element = n, this.offset = r }; return o.prototype.getTargetElement = function () { return !this.target && this.targetId && (this.target = document.getElementById(this.targetId) || document.getElementsByName(this.targetId)[0]), this.target }, o.prototype.getTargetPosition = function () { var e = this.getTargetElement(); return e ? e.getBoundingClientRect() : void 0 }, o.prototype.flushTargetCache = function () { this.targetId && (this.target = void 0) }, { link: function (l, u, i) { var c, a = i.ngHref || i.href; if (a && -1 !== a.indexOf(\"#\") ? c = a.replace(/.*(?=#[^\\s]+$)/, \"\").substring(1) : i.duScrollspy ? c = i.duScrollspy : i.duSmoothScroll && (c = i.duSmoothScroll), c) { var s = n(function () { var n = new o(c, l, u, -(i.offset ? parseInt(i.offset, 10) : t)); e.addSpy(n), l.$on(\"$locationChangeSuccess\", n.flushTargetCache.bind(n)); var a = r.$on(\"$stateChangeSuccess\", n.flushTargetCache.bind(n)); l.$on(\"$destroy\", function () { e.removeSpy(n), a() }) }, 0, !1); l.$on(\"$destroy\", function () { n.cancel(s) }) } } } }]);\n//# sourceMappingURL=angular-scroll.min.js.map\n/*! \n * angular-loading-bar v0.8.0\n * https://chieffancypants.github.io/angular-loading-bar\n * Copyright (c) 2015 Wes Cruver\n * License: MIT\n */\n!function(){\"use strict\";angular.module(\"angular-loading-bar\",[\"cfp.loadingBarInterceptor\"]),angular.module(\"chieffancypants.loadingBar\",[\"cfp.loadingBarInterceptor\"]),angular.module(\"cfp.loadingBarInterceptor\",[\"cfp.loadingBar\"]).config([\"$httpProvider\",function(a){var b=[\"$q\",\"$cacheFactory\",\"$timeout\",\"$rootScope\",\"$log\",\"cfpLoadingBar\",function(b,c,d,e,f,g){function h(){d.cancel(j),g.complete(),l=0,k=0}function i(b){var d,e=c.get(\"$http\"),f=a.defaults;!b.cache&&!f.cache||b.cache===!1||\"GET\"!==b.method&&\"JSONP\"!==b.method||(d=angular.isObject(b.cache)?b.cache:angular.isObject(f.cache)?f.cache:e);var g=void 0!==d?void 0!==d.get(b.url):!1;return void 0!==b.cached&&g!==b.cached?b.cached:(b.cached=g,g)}var j,k=0,l=0,m=g.latencyThreshold;return{request:function(a){return a.ignoreLoadingBar||i(a)||(e.$broadcast(\"cfpLoadingBar:loading\",{url:a.url}),0===k&&(j=d(function(){g.start()},m)),k++,g.set(l/k)),a},response:function(a){return a&&a.config?(a.config.ignoreLoadingBar||i(a.config)||(l++,e.$broadcast(\"cfpLoadingBar:loaded\",{url:a.config.url,result:a}),l>=k?h():g.set(l/k)),a):(f.error(\"Broken interceptor detected: Config object not supplied in response:\\n https://github.com/chieffancypants/angular-loading-bar/pull/50\"),a)},responseError:function(a){return a&&a.config?(a.config.ignoreLoadingBar||i(a.config)||(l++,e.$broadcast(\"cfpLoadingBar:loaded\",{url:a.config.url,result:a}),l>=k?h():g.set(l/k)),b.reject(a)):(f.error(\"Broken interceptor detected: Config object not supplied in rejection:\\n https://github.com/chieffancypants/angular-loading-bar/pull/50\"),b.reject(a))}}}];a.interceptors.push(b)}]),angular.module(\"cfp.loadingBar\",[]).provider(\"cfpLoadingBar\",function(){this.autoIncrement=!0,this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.02,this.parentSelector=\"body\",this.spinnerTemplate='<div id=\"loading-bar-spinner\"><div class=\"spinner-icon\"></div></div>',this.loadingBarTemplate='<div id=\"loading-bar\"><div class=\"bar\"><div class=\"peg\"></div></div></div>',this.$get=[\"$injector\",\"$document\",\"$timeout\",\"$rootScope\",function(a,b,c,d){function e(){k||(k=a.get(\"$animate\"));var e=b.find(n).eq(0);c.cancel(m),r||(d.$broadcast(\"cfpLoadingBar:started\"),r=!0,v&&k.enter(o,e,angular.element(e[0].lastChild)),u&&k.enter(q,e,angular.element(e[0].lastChild)),f(w))}function f(a){if(r){var b=100*a+\"%\";p.css(\"width\",b),s=a,t&&(c.cancel(l),l=c(function(){g()},250))}}function g(){if(!(h()>=1)){var a=0,b=h();a=b>=0&&.25>b?(3*Math.random()+3)/100:b>=.25&&.65>b?3*Math.random()/100:b>=.65&&.9>b?2*Math.random()/100:b>=.9&&.99>b?.005:0;var c=h()+a;f(c)}}function h(){return s}function i(){s=0,r=!1}function j(){k||(k=a.get(\"$animate\")),d.$broadcast(\"cfpLoadingBar:completed\"),f(1),c.cancel(m),m=c(function(){var a=k.leave(o,i);a&&a.then&&a.then(i),k.leave(q)},500)}var k,l,m,n=this.parentSelector,o=angular.element(this.loadingBarTemplate),p=o.find(\"div\").eq(0),q=angular.element(this.spinnerTemplate),r=!1,s=0,t=this.autoIncrement,u=this.includeSpinner,v=this.includeBar,w=this.startSize;return{start:e,set:f,status:h,inc:g,complete:j,autoIncrement:this.autoIncrement,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}();\n(function (window) {\n    'use strict';\n    angular.module('tmh.dynamicLocale', []).provider('tmhDynamicLocale', function () {\n\n        var defaultLocale,\n          localeLocationPattern = 'angular/i18n/angular-locale_{{locale}}.js',\n          storageFactory = 'tmhDynamicLocaleStorageCache',\n          storage,\n          storeKey = 'tmhDynamicLocale.locale',\n          promiseCache = {},\n          activeLocale;\n\n        /**\n         * Loads a script asynchronously\n         *\n         * @param {string} url The url for the script\n         @ @param {function) callback A function to be called once the script is loaded\n         */\n        function loadScript(url, callback, errorCallback, $timeout) {\n            var script = document.createElement('script'),\n              body = document.getElementsByTagName('body')[0],\n              removed = false;\n\n            script.type = 'text/javascript';\n            if (script.readyState) { // IE\n                script.onreadystatechange = function () {\n                    if (script.readyState === 'complete' ||\n                        script.readyState === 'loaded') {\n                        script.onreadystatechange = null;\n                        $timeout(\n                          function () {\n                              if (removed) return;\n                              removed = true;\n                              body.removeChild(script);\n                              callback();\n                          }, 30, false);\n                    }\n                };\n            } else { // Others\n                script.onload = function () {\n                    if (removed) return;\n                    removed = true;\n                    body.removeChild(script);\n                    callback();\n                };\n                script.onerror = function () {\n                    if (removed) return;\n                    removed = true;\n                    body.removeChild(script);\n                    errorCallback();\n                };\n            }\n            script.src = url;\n            script.async = false;\n            body.appendChild(script);\n        }\n\n        /**\n         * Loads a locale and replaces the properties from the current locale with the new locale information\n         *\n         * @param localeUrl The path to the new locale\n         * @param $locale The locale at the curent scope\n         */\n        function loadLocale(localeUrl, $locale, localeId, $rootScope, $q, localeCache, $timeout) {\n\n            function overrideValues(oldObject, newObject) {\n                if (activeLocale !== localeId) {\n                    return;\n                }\n                angular.forEach(oldObject, function (value, key) {\n                    if (!newObject[key]) {\n                        delete oldObject[key];\n                    } else if (angular.isArray(newObject[key])) {\n                        oldObject[key].length = newObject[key].length;\n                    }\n                });\n                angular.forEach(newObject, function (value, key) {\n                    if (angular.isArray(newObject[key]) || angular.isObject(newObject[key])) {\n                        if (!oldObject[key]) {\n                            oldObject[key] = angular.isArray(newObject[key]) ? [] : {};\n                        }\n                        overrideValues(oldObject[key], newObject[key]);\n                    } else {\n                        oldObject[key] = newObject[key];\n                    }\n                });\n            }\n\n\n            if (promiseCache[localeId]) return promiseCache[localeId];\n\n            var cachedLocale,\n              deferred = $q.defer();\n            if (localeId === activeLocale) {\n                deferred.resolve($locale);\n            } else if ((cachedLocale = localeCache.get(localeId))) {\n                activeLocale = localeId;\n                $rootScope.$evalAsync(function () {\n                    overrideValues($locale, cachedLocale);\n                    $rootScope.$broadcast('$localeChangeSuccess', localeId, $locale);\n                    storage.put(storeKey, localeId);\n                    deferred.resolve($locale);\n                });\n            } else {\n                activeLocale = localeId;\n                promiseCache[localeId] = deferred.promise;\n                loadScript(localeUrl, function () {\n                    // Create a new injector with the new locale\n                    var localInjector = angular.injector(['ngLocale']),\n                      externalLocale = localInjector.get('$locale');\n\n                    overrideValues($locale, externalLocale);\n                    localeCache.put(localeId, externalLocale);\n                    delete promiseCache[localeId];\n\n                    $rootScope.$apply(function () {\n                        $rootScope.$broadcast('$localeChangeSuccess', localeId, $locale);\n                        storage.put(storeKey, localeId);\n                        deferred.resolve($locale);\n                    });\n                }, function () {\n                    delete promiseCache[localeId];\n\n                    $rootScope.$apply(function () {\n                        $rootScope.$broadcast('$localeChangeError', localeId);\n                        deferred.reject(localeId);\n                    });\n                }, $timeout);\n            }\n            return deferred.promise;\n        }\n\n        this.localeLocationPattern = function (value) {\n            if (value) {\n                localeLocationPattern = value;\n                return this;\n            } else {\n                return localeLocationPattern;\n            }\n        };\n\n        this.useStorage = function (storageName) {\n            storageFactory = storageName;\n        };\n\n        this.useCookieStorage = function () {\n            this.useStorage('$cookieStore');\n        };\n\n        this.defaultLocale = function (value) {\n            defaultLocale = value;\n        };\n\n        this.$get = ['$rootScope', '$injector', '$interpolate', '$locale', '$q', 'tmhDynamicLocaleCache', '$timeout', function ($rootScope, $injector, interpolate, locale, $q, tmhDynamicLocaleCache, $timeout) {\n            var localeLocation = interpolate(localeLocationPattern);\n\n            storage = $injector.get(storageFactory);\n            $rootScope.$evalAsync(function () {\n                var initialLocale;\n                if ((initialLocale = (storage.get(storeKey) || defaultLocale))) {\n                    loadLocale(localeLocation({ locale: initialLocale }), locale, initialLocale, $rootScope, $q, tmhDynamicLocaleCache, $timeout);\n                }\n            });\n            return {\n                /**\n                 * @ngdoc method\n                 * @description\n                 * @param {string=} value Sets the locale to the new locale. Changing the locale will trigger\n                 *    a background task that will retrieve the new locale and configure the current $locale\n                 *    instance with the information from the new locale\n                 */\n                set: function (value) {\n                    return loadLocale(localeLocation({ locale: value }), locale, value, $rootScope, $q, tmhDynamicLocaleCache, $timeout);\n                }\n            };\n        }];\n    }).provider('tmhDynamicLocaleCache', function () {\n        this.$get = ['$cacheFactory', function ($cacheFactory) {\n            return $cacheFactory('tmh.dynamicLocales');\n        }];\n    }).provider('tmhDynamicLocaleStorageCache', function () {\n        this.$get = ['$cacheFactory', function ($cacheFactory) {\n            return $cacheFactory('tmh.dynamicLocales.store');\n        }];\n    }).run(['tmhDynamicLocale', angular.noop]);\n}(window));\n//     Underscore.js 1.8.3\n//     http://underscorejs.org\n//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Underscore may be freely distributed under the MIT license.\n(function () { function n(n) { function t(t, r, e, u, i, o) { for (; i >= 0 && o > i; i += n) { var a = u ? u[i] : i; e = r(e, t[a], a, t) } return e } return function (r, e, u, i) { e = b(e, i, 4); var o = !k(r) && m.keys(r), a = (o || r).length, c = n > 0 ? 0 : a - 1; return arguments.length < 3 && (u = r[o ? o[c] : c], c += n), t(r, e, u, o, c, a) } } function t(n) { return function (t, r, e) { r = x(r, e); for (var u = O(t), i = n > 0 ? 0 : u - 1; i >= 0 && u > i; i += n) if (r(t[i], i, t)) return i; return -1 } } function r(n, t, r) { return function (e, u, i) { var o = 0, a = O(e); if (\"number\" == typeof i) n > 0 ? o = i >= 0 ? i : Math.max(i + a, o) : a = i >= 0 ? Math.min(i + 1, a) : i + a + 1; else if (r && i && a) return i = r(e, u), e[i] === u ? i : -1; if (u !== u) return i = t(l.call(e, o, a), m.isNaN), i >= 0 ? i + o : -1; for (i = n > 0 ? o : a - 1; i >= 0 && a > i; i += n) if (e[i] === u) return i; return -1 } } function e(n, t) { var r = I.length, e = n.constructor, u = m.isFunction(e) && e.prototype || a, i = \"constructor\"; for (m.has(n, i) && !m.contains(t, i) && t.push(i) ; r--;) i = I[r], i in n && n[i] !== u[i] && !m.contains(t, i) && t.push(i) } var u = this, i = u._, o = Array.prototype, a = Object.prototype, c = Function.prototype, f = o.push, l = o.slice, s = a.toString, p = a.hasOwnProperty, h = Array.isArray, v = Object.keys, g = c.bind, y = Object.create, d = function () { }, m = function (n) { return n instanceof m ? n : this instanceof m ? void (this._wrapped = n) : new m(n) }; \"undefined\" != typeof exports ? (\"undefined\" != typeof module && module.exports && (exports = module.exports = m), exports._ = m) : u._ = m, m.VERSION = \"1.8.3\"; var b = function (n, t, r) { if (t === void 0) return n; switch (null == r ? 3 : r) { case 1: return function (r) { return n.call(t, r) }; case 2: return function (r, e) { return n.call(t, r, e) }; case 3: return function (r, e, u) { return n.call(t, r, e, u) }; case 4: return function (r, e, u, i) { return n.call(t, r, e, u, i) } } return function () { return n.apply(t, arguments) } }, x = function (n, t, r) { return null == n ? m.identity : m.isFunction(n) ? b(n, t, r) : m.isObject(n) ? m.matcher(n) : m.property(n) }; m.iteratee = function (n, t) { return x(n, t, 1 / 0) }; var _ = function (n, t) { return function (r) { var e = arguments.length; if (2 > e || null == r) return r; for (var u = 1; e > u; u++) for (var i = arguments[u], o = n(i), a = o.length, c = 0; a > c; c++) { var f = o[c]; t && r[f] !== void 0 || (r[f] = i[f]) } return r } }, j = function (n) { if (!m.isObject(n)) return {}; if (y) return y(n); d.prototype = n; var t = new d; return d.prototype = null, t }, w = function (n) { return function (t) { return null == t ? void 0 : t[n] } }, A = Math.pow(2, 53) - 1, O = w(\"length\"), k = function (n) { var t = O(n); return \"number\" == typeof t && t >= 0 && A >= t }; m.each = m.forEach = function (n, t, r) { t = b(t, r); var e, u; if (k(n)) for (e = 0, u = n.length; u > e; e++) t(n[e], e, n); else { var i = m.keys(n); for (e = 0, u = i.length; u > e; e++) t(n[i[e]], i[e], n) } return n }, m.map = m.collect = function (n, t, r) { t = x(t, r); for (var e = !k(n) && m.keys(n), u = (e || n).length, i = Array(u), o = 0; u > o; o++) { var a = e ? e[o] : o; i[o] = t(n[a], a, n) } return i }, m.reduce = m.foldl = m.inject = n(1), m.reduceRight = m.foldr = n(-1), m.find = m.detect = function (n, t, r) { var e; return e = k(n) ? m.findIndex(n, t, r) : m.findKey(n, t, r), e !== void 0 && e !== -1 ? n[e] : void 0 }, m.filter = m.select = function (n, t, r) { var e = []; return t = x(t, r), m.each(n, function (n, r, u) { t(n, r, u) && e.push(n) }), e }, m.reject = function (n, t, r) { return m.filter(n, m.negate(x(t)), r) }, m.every = m.all = function (n, t, r) { t = x(t, r); for (var e = !k(n) && m.keys(n), u = (e || n).length, i = 0; u > i; i++) { var o = e ? e[i] : i; if (!t(n[o], o, n)) return !1 } return !0 }, m.some = m.any = function (n, t, r) { t = x(t, r); for (var e = !k(n) && m.keys(n), u = (e || n).length, i = 0; u > i; i++) { var o = e ? e[i] : i; if (t(n[o], o, n)) return !0 } return !1 }, m.contains = m.includes = m.include = function (n, t, r, e) { return k(n) || (n = m.values(n)), (\"number\" != typeof r || e) && (r = 0), m.indexOf(n, t, r) >= 0 }, m.invoke = function (n, t) { var r = l.call(arguments, 2), e = m.isFunction(t); return m.map(n, function (n) { var u = e ? t : n[t]; return null == u ? u : u.apply(n, r) }) }, m.pluck = function (n, t) { return m.map(n, m.property(t)) }, m.where = function (n, t) { return m.filter(n, m.matcher(t)) }, m.findWhere = function (n, t) { return m.find(n, m.matcher(t)) }, m.max = function (n, t, r) { var e, u, i = -1 / 0, o = -1 / 0; if (null == t && null != n) { n = k(n) ? n : m.values(n); for (var a = 0, c = n.length; c > a; a++) e = n[a], e > i && (i = e) } else t = x(t, r), m.each(n, function (n, r, e) { u = t(n, r, e), (u > o || u === -1 / 0 && i === -1 / 0) && (i = n, o = u) }); return i }, m.min = function (n, t, r) { var e, u, i = 1 / 0, o = 1 / 0; if (null == t && null != n) { n = k(n) ? n : m.values(n); for (var a = 0, c = n.length; c > a; a++) e = n[a], i > e && (i = e) } else t = x(t, r), m.each(n, function (n, r, e) { u = t(n, r, e), (o > u || 1 / 0 === u && 1 / 0 === i) && (i = n, o = u) }); return i }, m.shuffle = function (n) { for (var t, r = k(n) ? n : m.values(n), e = r.length, u = Array(e), i = 0; e > i; i++) t = m.random(0, i), t !== i && (u[i] = u[t]), u[t] = r[i]; return u }, m.sample = function (n, t, r) { return null == t || r ? (k(n) || (n = m.values(n)), n[m.random(n.length - 1)]) : m.shuffle(n).slice(0, Math.max(0, t)) }, m.sortBy = function (n, t, r) { return t = x(t, r), m.pluck(m.map(n, function (n, r, e) { return { value: n, index: r, criteria: t(n, r, e) } }).sort(function (n, t) { var r = n.criteria, e = t.criteria; if (r !== e) { if (r > e || r === void 0) return 1; if (e > r || e === void 0) return -1 } return n.index - t.index }), \"value\") }; var F = function (n) { return function (t, r, e) { var u = {}; return r = x(r, e), m.each(t, function (e, i) { var o = r(e, i, t); n(u, e, o) }), u } }; m.groupBy = F(function (n, t, r) { m.has(n, r) ? n[r].push(t) : n[r] = [t] }), m.indexBy = F(function (n, t, r) { n[r] = t }), m.countBy = F(function (n, t, r) { m.has(n, r) ? n[r]++ : n[r] = 1 }), m.toArray = function (n) { return n ? m.isArray(n) ? l.call(n) : k(n) ? m.map(n, m.identity) : m.values(n) : [] }, m.size = function (n) { return null == n ? 0 : k(n) ? n.length : m.keys(n).length }, m.partition = function (n, t, r) { t = x(t, r); var e = [], u = []; return m.each(n, function (n, r, i) { (t(n, r, i) ? e : u).push(n) }), [e, u] }, m.first = m.head = m.take = function (n, t, r) { return null == n ? void 0 : null == t || r ? n[0] : m.initial(n, n.length - t) }, m.initial = function (n, t, r) { return l.call(n, 0, Math.max(0, n.length - (null == t || r ? 1 : t))) }, m.last = function (n, t, r) { return null == n ? void 0 : null == t || r ? n[n.length - 1] : m.rest(n, Math.max(0, n.length - t)) }, m.rest = m.tail = m.drop = function (n, t, r) { return l.call(n, null == t || r ? 1 : t) }, m.compact = function (n) { return m.filter(n, m.identity) }; var S = function (n, t, r, e) { for (var u = [], i = 0, o = e || 0, a = O(n) ; a > o; o++) { var c = n[o]; if (k(c) && (m.isArray(c) || m.isArguments(c))) { t || (c = S(c, t, r)); var f = 0, l = c.length; for (u.length += l; l > f;) u[i++] = c[f++] } else r || (u[i++] = c) } return u }; m.flatten = function (n, t) { return S(n, t, !1) }, m.without = function (n) { return m.difference(n, l.call(arguments, 1)) }, m.uniq = m.unique = function (n, t, r, e) { m.isBoolean(t) || (e = r, r = t, t = !1), null != r && (r = x(r, e)); for (var u = [], i = [], o = 0, a = O(n) ; a > o; o++) { var c = n[o], f = r ? r(c, o, n) : c; t ? (o && i === f || u.push(c), i = f) : r ? m.contains(i, f) || (i.push(f), u.push(c)) : m.contains(u, c) || u.push(c) } return u }, m.union = function () { return m.uniq(S(arguments, !0, !0)) }, m.intersection = function (n) { for (var t = [], r = arguments.length, e = 0, u = O(n) ; u > e; e++) { var i = n[e]; if (!m.contains(t, i)) { for (var o = 1; r > o && m.contains(arguments[o], i) ; o++); o === r && t.push(i) } } return t }, m.difference = function (n) { var t = S(arguments, !0, !0, 1); return m.filter(n, function (n) { return !m.contains(t, n) }) }, m.zip = function () { return m.unzip(arguments) }, m.unzip = function (n) { for (var t = n && m.max(n, O).length || 0, r = Array(t), e = 0; t > e; e++) r[e] = m.pluck(n, e); return r }, m.object = function (n, t) { for (var r = {}, e = 0, u = O(n) ; u > e; e++) t ? r[n[e]] = t[e] : r[n[e][0]] = n[e][1]; return r }, m.findIndex = t(1), m.findLastIndex = t(-1), m.sortedIndex = function (n, t, r, e) { r = x(r, e, 1); for (var u = r(t), i = 0, o = O(n) ; o > i;) { var a = Math.floor((i + o) / 2); r(n[a]) < u ? i = a + 1 : o = a } return i }, m.indexOf = r(1, m.findIndex, m.sortedIndex), m.lastIndexOf = r(-1, m.findLastIndex), m.range = function (n, t, r) { null == t && (t = n || 0, n = 0), r = r || 1; for (var e = Math.max(Math.ceil((t - n) / r), 0), u = Array(e), i = 0; e > i; i++, n += r) u[i] = n; return u }; var E = function (n, t, r, e, u) { if (!(e instanceof t)) return n.apply(r, u); var i = j(n.prototype), o = n.apply(i, u); return m.isObject(o) ? o : i }; m.bind = function (n, t) { if (g && n.bind === g) return g.apply(n, l.call(arguments, 1)); if (!m.isFunction(n)) throw new TypeError(\"Bind must be called on a function\"); var r = l.call(arguments, 2), e = function () { return E(n, e, t, this, r.concat(l.call(arguments))) }; return e }, m.partial = function (n) { var t = l.call(arguments, 1), r = function () { for (var e = 0, u = t.length, i = Array(u), o = 0; u > o; o++) i[o] = t[o] === m ? arguments[e++] : t[o]; for (; e < arguments.length;) i.push(arguments[e++]); return E(n, r, this, this, i) }; return r }, m.bindAll = function (n) { var t, r, e = arguments.length; if (1 >= e) throw new Error(\"bindAll must be passed function names\"); for (t = 1; e > t; t++) r = arguments[t], n[r] = m.bind(n[r], n); return n }, m.memoize = function (n, t) { var r = function (e) { var u = r.cache, i = \"\" + (t ? t.apply(this, arguments) : e); return m.has(u, i) || (u[i] = n.apply(this, arguments)), u[i] }; return r.cache = {}, r }, m.delay = function (n, t) { var r = l.call(arguments, 2); return setTimeout(function () { return n.apply(null, r) }, t) }, m.defer = m.partial(m.delay, m, 1), m.throttle = function (n, t, r) { var e, u, i, o = null, a = 0; r || (r = {}); var c = function () { a = r.leading === !1 ? 0 : m.now(), o = null, i = n.apply(e, u), o || (e = u = null) }; return function () { var f = m.now(); a || r.leading !== !1 || (a = f); var l = t - (f - a); return e = this, u = arguments, 0 >= l || l > t ? (o && (clearTimeout(o), o = null), a = f, i = n.apply(e, u), o || (e = u = null)) : o || r.trailing === !1 || (o = setTimeout(c, l)), i } }, m.debounce = function (n, t, r) { var e, u, i, o, a, c = function () { var f = m.now() - o; t > f && f >= 0 ? e = setTimeout(c, t - f) : (e = null, r || (a = n.apply(i, u), e || (i = u = null))) }; return function () { i = this, u = arguments, o = m.now(); var f = r && !e; return e || (e = setTimeout(c, t)), f && (a = n.apply(i, u), i = u = null), a } }, m.wrap = function (n, t) { return m.partial(t, n) }, m.negate = function (n) { return function () { return !n.apply(this, arguments) } }, m.compose = function () { var n = arguments, t = n.length - 1; return function () { for (var r = t, e = n[t].apply(this, arguments) ; r--;) e = n[r].call(this, e); return e } }, m.after = function (n, t) { return function () { return --n < 1 ? t.apply(this, arguments) : void 0 } }, m.before = function (n, t) { var r; return function () { return --n > 0 && (r = t.apply(this, arguments)), 1 >= n && (t = null), r } }, m.once = m.partial(m.before, 2); var M = !{ toString: null }.propertyIsEnumerable(\"toString\"), I = [\"valueOf\", \"isPrototypeOf\", \"toString\", \"propertyIsEnumerable\", \"hasOwnProperty\", \"toLocaleString\"]; m.keys = function (n) { if (!m.isObject(n)) return []; if (v) return v(n); var t = []; for (var r in n) m.has(n, r) && t.push(r); return M && e(n, t), t }, m.allKeys = function (n) { if (!m.isObject(n)) return []; var t = []; for (var r in n) t.push(r); return M && e(n, t), t }, m.values = function (n) { for (var t = m.keys(n), r = t.length, e = Array(r), u = 0; r > u; u++) e[u] = n[t[u]]; return e }, m.mapObject = function (n, t, r) { t = x(t, r); for (var e, u = m.keys(n), i = u.length, o = {}, a = 0; i > a; a++) e = u[a], o[e] = t(n[e], e, n); return o }, m.pairs = function (n) { for (var t = m.keys(n), r = t.length, e = Array(r), u = 0; r > u; u++) e[u] = [t[u], n[t[u]]]; return e }, m.invert = function (n) { for (var t = {}, r = m.keys(n), e = 0, u = r.length; u > e; e++) t[n[r[e]]] = r[e]; return t }, m.functions = m.methods = function (n) { var t = []; for (var r in n) m.isFunction(n[r]) && t.push(r); return t.sort() }, m.extend = _(m.allKeys), m.extendOwn = m.assign = _(m.keys), m.findKey = function (n, t, r) { t = x(t, r); for (var e, u = m.keys(n), i = 0, o = u.length; o > i; i++) if (e = u[i], t(n[e], e, n)) return e }, m.pick = function (n, t, r) { var e, u, i = {}, o = n; if (null == o) return i; m.isFunction(t) ? (u = m.allKeys(o), e = b(t, r)) : (u = S(arguments, !1, !1, 1), e = function (n, t, r) { return t in r }, o = Object(o)); for (var a = 0, c = u.length; c > a; a++) { var f = u[a], l = o[f]; e(l, f, o) && (i[f] = l) } return i }, m.omit = function (n, t, r) { if (m.isFunction(t)) t = m.negate(t); else { var e = m.map(S(arguments, !1, !1, 1), String); t = function (n, t) { return !m.contains(e, t) } } return m.pick(n, t, r) }, m.defaults = _(m.allKeys, !0), m.create = function (n, t) { var r = j(n); return t && m.extendOwn(r, t), r }, m.clone = function (n) { return m.isObject(n) ? m.isArray(n) ? n.slice() : m.extend({}, n) : n }, m.tap = function (n, t) { return t(n), n }, m.isMatch = function (n, t) { var r = m.keys(t), e = r.length; if (null == n) return !e; for (var u = Object(n), i = 0; e > i; i++) { var o = r[i]; if (t[o] !== u[o] || !(o in u)) return !1 } return !0 }; var N = function (n, t, r, e) { if (n === t) return 0 !== n || 1 / n === 1 / t; if (null == n || null == t) return n === t; n instanceof m && (n = n._wrapped), t instanceof m && (t = t._wrapped); var u = s.call(n); if (u !== s.call(t)) return !1; switch (u) { case \"[object RegExp]\": case \"[object String]\": return \"\" + n == \"\" + t; case \"[object Number]\": return +n !== +n ? +t !== +t : 0 === +n ? 1 / +n === 1 / t : +n === +t; case \"[object Date]\": case \"[object Boolean]\": return +n === +t } var i = \"[object Array]\" === u; if (!i) { if (\"object\" != typeof n || \"object\" != typeof t) return !1; var o = n.constructor, a = t.constructor; if (o !== a && !(m.isFunction(o) && o instanceof o && m.isFunction(a) && a instanceof a) && \"constructor\" in n && \"constructor\" in t) return !1 } r = r || [], e = e || []; for (var c = r.length; c--;) if (r[c] === n) return e[c] === t; if (r.push(n), e.push(t), i) { if (c = n.length, c !== t.length) return !1; for (; c--;) if (!N(n[c], t[c], r, e)) return !1 } else { var f, l = m.keys(n); if (c = l.length, m.keys(t).length !== c) return !1; for (; c--;) if (f = l[c], !m.has(t, f) || !N(n[f], t[f], r, e)) return !1 } return r.pop(), e.pop(), !0 }; m.isEqual = function (n, t) { return N(n, t) }, m.isEmpty = function (n) { return null == n ? !0 : k(n) && (m.isArray(n) || m.isString(n) || m.isArguments(n)) ? 0 === n.length : 0 === m.keys(n).length }, m.isElement = function (n) { return !(!n || 1 !== n.nodeType) }, m.isArray = h || function (n) { return \"[object Array]\" === s.call(n) }, m.isObject = function (n) { var t = typeof n; return \"function\" === t || \"object\" === t && !!n }, m.each([\"Arguments\", \"Function\", \"String\", \"Number\", \"Date\", \"RegExp\", \"Error\"], function (n) { m[\"is\" + n] = function (t) { return s.call(t) === \"[object \" + n + \"]\" } }), m.isArguments(arguments) || (m.isArguments = function (n) { return m.has(n, \"callee\") }), \"function\" != typeof /./ && \"object\" != typeof Int8Array && (m.isFunction = function (n) { return \"function\" == typeof n || !1 }), m.isFinite = function (n) { return isFinite(n) && !isNaN(parseFloat(n)) }, m.isNaN = function (n) { return m.isNumber(n) && n !== +n }, m.isBoolean = function (n) { return n === !0 || n === !1 || \"[object Boolean]\" === s.call(n) }, m.isNull = function (n) { return null === n }, m.isUndefined = function (n) { return n === void 0 }, m.has = function (n, t) { return null != n && p.call(n, t) }, m.noConflict = function () { return u._ = i, this }, m.identity = function (n) { return n }, m.constant = function (n) { return function () { return n } }, m.noop = function () { }, m.property = w, m.propertyOf = function (n) { return null == n ? function () { } : function (t) { return n[t] } }, m.matcher = m.matches = function (n) { return n = m.extendOwn({}, n), function (t) { return m.isMatch(t, n) } }, m.times = function (n, t, r) { var e = Array(Math.max(0, n)); t = b(t, r, 1); for (var u = 0; n > u; u++) e[u] = t(u); return e }, m.random = function (n, t) { return null == t && (t = n, n = 0), n + Math.floor(Math.random() * (t - n + 1)) }, m.now = Date.now || function () { return (new Date).getTime() }; var B = { \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#x27;\", \"`\": \"&#x60;\" }, T = m.invert(B), R = function (n) { var t = function (t) { return n[t] }, r = \"(?:\" + m.keys(n).join(\"|\") + \")\", e = RegExp(r), u = RegExp(r, \"g\"); return function (n) { return n = null == n ? \"\" : \"\" + n, e.test(n) ? n.replace(u, t) : n } }; m.escape = R(B), m.unescape = R(T), m.result = function (n, t, r) { var e = null == n ? void 0 : n[t]; return e === void 0 && (e = r), m.isFunction(e) ? e.call(n) : e }; var q = 0; m.uniqueId = function (n) { var t = ++q + \"\"; return n ? n + t : t }, m.templateSettings = { evaluate: /<%([\\s\\S]+?)%>/g, interpolate: /<%=([\\s\\S]+?)%>/g, escape: /<%-([\\s\\S]+?)%>/g }; var K = /(.)^/, z = { \"'\": \"'\", \"\\\\\": \"\\\\\", \"\\r\": \"r\", \"\\n\": \"n\", \"\\u2028\": \"u2028\", \"\\u2029\": \"u2029\" }, D = /\\\\|'|\\r|\\n|\\u2028|\\u2029/g, L = function (n) { return \"\\\\\" + z[n] }; m.template = function (n, t, r) { !t && r && (t = r), t = m.defaults({}, t, m.templateSettings); var e = RegExp([(t.escape || K).source, (t.interpolate || K).source, (t.evaluate || K).source].join(\"|\") + \"|$\", \"g\"), u = 0, i = \"__p+='\"; n.replace(e, function (t, r, e, o, a) { return i += n.slice(u, a).replace(D, L), u = a + t.length, r ? i += \"'+\\n((__t=(\" + r + \"))==null?'':_.escape(__t))+\\n'\" : e ? i += \"'+\\n((__t=(\" + e + \"))==null?'':__t)+\\n'\" : o && (i += \"';\\n\" + o + \"\\n__p+='\"), t }), i += \"';\\n\", t.variable || (i = \"with(obj||{}){\\n\" + i + \"}\\n\"), i = \"var __t,__p='',__j=Array.prototype.join,\" + \"print=function(){__p+=__j.call(arguments,'');};\\n\" + i + \"return __p;\\n\"; try { var o = new Function(t.variable || \"obj\", \"_\", i) } catch (a) { throw a.source = i, a } var c = function (n) { return o.call(this, n, m) }, f = t.variable || \"obj\"; return c.source = \"function(\" + f + \"){\\n\" + i + \"}\", c }, m.chain = function (n) { var t = m(n); return t._chain = !0, t }; var P = function (n, t) { return n._chain ? m(t).chain() : t }; m.mixin = function (n) { m.each(m.functions(n), function (t) { var r = m[t] = n[t]; m.prototype[t] = function () { var n = [this._wrapped]; return f.apply(n, arguments), P(this, r.apply(m, n)) } }) }, m.mixin(m), m.each([\"pop\", \"push\", \"reverse\", \"shift\", \"sort\", \"splice\", \"unshift\"], function (n) { var t = o[n]; m.prototype[n] = function () { var r = this._wrapped; return t.apply(r, arguments), \"shift\" !== n && \"splice\" !== n || 0 !== r.length || delete r[0], P(this, r) } }), m.each([\"concat\", \"join\", \"slice\"], function (n) { var t = o[n]; m.prototype[n] = function () { return P(this, t.apply(this._wrapped, arguments)) } }), m.prototype.value = function () { return this._wrapped }, m.prototype.valueOf = m.prototype.toJSON = m.prototype.value, m.prototype.toString = function () { return \"\" + this._wrapped }, \"function\" == typeof define && define.amd && define(\"underscore\", [], function () { return m }) }).call(this);\n//# sourceMappingURL=underscore-min.map\nvar utils = (function () {\n\n    // These are general, home-grown javascript functions for common functions used withing the app.\n\n    function setCookie(name, value, minutes) {\n        if (minutes) {\n            var date = new Date();\n            date.setTime(date.getTime() + (minutes * 60 * 1000));\n            var expires = \"; expires=\" + date.toUTCString();\n        }\n        else var expires = \"\";\n        document.cookie = name + \"=\" + value + expires + \"; path=/\";\n    }\n\n    function getCookie(name) {\n        if (document.cookie.length > 0) {\n            c_start = document.cookie.indexOf(name + \"=\");\n            if (c_start != -1) {\n                c_start = c_start + name.length + 1;\n                c_end = document.cookie.indexOf(\";\", c_start);\n                if (c_end == -1) {\n                    c_end = document.cookie.length;\n                }\n                return unescape(document.cookie.substring(c_start, c_end));\n            }\n        }\n        return null;\n    }\n\n    function deleteCookie(name) {\n        setCookie(name, \"\", -60);\n    }\n\n    function resetCookieExpiration(name, minutes) {\n\n        var value = getCookie(name);\n\n        if (value != null) {\n            setCookie(name, value, minutes);\n        }\n\n    }\n\n    function getPageHashParameters() {\n\n        return getHashParameters(window.location.href);\n\n    }\n\n    function getHashParameters(url) {\n\n        var hashParameters = {};\n\n        if (url.indexOf(\"#\") == -1) {\n            return hashParameters;\n        }\n\n        var e,\n            a = /\\+/g,  // Regex for replacing addition symbol with a space\n            r = /([^&;=]+)=?([^&;]*)/g,\n            d = function (s) { return decodeURIComponent(s.replace(a, \" \")); },\n            q = url.substring(url.indexOf(\"#\") + 1);\n\n        while (e = r.exec(q))\n            hashParameters[d(e[1])] = d(e[2]);\n\n        return hashParameters;\n    }\n\n    function getPageQueryParameters() {\n\n        return getQueryParameters(window.location.href);\n\n    }\n\n    function getQueryParameters(url) {\n\n        if (url.indexOf(\"?\") == -1) {\n            return {};\n        }\n\n        q = url.substring(url.indexOf(\"?\") + 1);\n\n        // Strip off any hash parameters\n        if (q.indexOf(\"#\") > 0) {\n            q = q.substring(0, q.indexOf(\"#\"));\n        }\n\n        return parseQueryParameters(q);\n    }\n\n    function parseQueryParameters(query) {\n\n        var queryParameters = {};\n\n        if (isNullOrEmpty(query)) {\n            return queryParameters;\n        }\n\n        var e,\n        a = /\\+/g,  // Regex for replacing addition symbol with a space\n        r = /([^&;=]+)=?([^&;]*)/g,\n        d = function (s) { return decodeURIComponent(s.replace(a, \" \")); }\n        queryParameters = {};\n\n        while (e = r.exec(query))\n            queryParameters[d(e[1])] = d(e[2]);\n\n        return queryParameters;\n\n    }\n\n    function appendParams(url, params) {\n\n        if (params.length == 0) {\n            return url;\n        }\n\n        url += \"?\";\n\n        _.each(params, function (item, index) {\n            url += index + \"=\" + item + \"&\";\n        });\n\n        // remove the trailing ampersand\n        url = url.substring(0, (url.length - 1));\n\n        return url;\n\n    }\n\n    function left(str, n) {\n        if (n <= 0)\n            return \"\";\n        else if (n > String(str).length)\n            return str;\n        else\n            return String(str).substring(0, n);\n    }\n\n    function right(str, n) {\n        if (n <= 0)\n            return \"\";\n        else if (n > String(str).length)\n            return str;\n        else {\n            var iLen = String(str).length;\n            return String(str).substring(iLen, iLen - n);\n        }\n    }\n\n    function isValidNumber(value) {\n        return !isNaN(parseFloat(value)) && isFinite(value);\n    }\n\n    function isValidInteger(value) {\n\n        if (isValidNumber(value) == false) {\n            return false;\n        }\n\n        value = parseFloat(value);\n\n        var result = (value === (parseInt(value) | 0));\n\n        return result;\n    }\n\n    function isValidEmail(value) {\n\n        // http://stackoverflow.com/a/46181/2002383 anystring@anystring.anystring\n        return /\\S+@\\S+\\.\\S+/.test(value);\n\n    }\n\n    function getRandom() {\n        return Math.floor((Math.random() * 10000000) + 1);\n    }\n\n    function hasProperty(obj, prop) {\n\n        // Determine if an object has a particular property http://stackoverflow.com/a/136411/2002383\n\n        if (obj != null) {\n            var proto = obj.__proto__ || obj.constructor.prototype;\n            return (prop in obj) &&\n                (!(prop in proto) || proto[prop] !== obj[prop]);\n        }\n\n        return false;\n    }\n\n    function sumProperties(collection, prop) {\n\n        // Get the sum of a particular property from a collection\n        var sum = 0;\n\n        _.each(collection, function (item) {\n            if (hasProperty(item, prop)) {\n                sum += item[prop];\n            }\n        });\n\n        return sum;\n    }\n\n    function areEqual() {\n        \n        // For an unlimited number of parameters, determines if they are all equal, i.e. areEqual(x, y, z, ...)\n        var len = arguments.length;\n        for (var i = 1; i < len; i++) {\n            if (arguments[i] == null || arguments[i] != arguments[i - 1])\n                return false;\n        }\n\n        return true;\n    }\n\n    function isNullOrEmpty(string) {\n\n        if (string == null || string == undefined) {\n            return true;\n        }\n\n        if (string == \"\") {\n            return true;\n        }\n\n        if (removeWhitespace(string) == null) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n    function stringsToBool(object) {\n\n        // This converts all properties with \"true\" and \"false\" values to true and false, respectively.\n\n        for (var property in object) {\n            if (object.hasOwnProperty(property)) {\n                if (object[property] === \"false\") {\n                    object[property] = false;\n                }\n                if (object[property] === \"true\") {\n                    object[property] = true;\n                }\n            }\n        }\n    }\n\n    function stringToBool(string) {\n        return (string == \"true\");\n    }\n\n    function removeWhitespace(string) {\n        return string.replace(/ /g, '');\n    }\n    \n    function convert(money, rate) {\n        return Math.round((money * rate) * 100) / 100;\n    }\n\n    function luhnCheck(value) {\n\n        var nCheck = 0, nDigit = 0, bEven = false;\n        value = value.replace(/\\D/g, \"\");\n\n        for (var n = value.length - 1; n >= 0; n--) {\n            var cDigit = value.charAt(n);\n            nDigit = parseInt(cDigit, 10);\n\n            if (bEven) {\n                if ((nDigit *= 2) > 9) nDigit -= 9;\n            }\n\n            nCheck += nDigit;\n            bEven = !bEven;\n        }\n\n        return (nCheck % 10) == 0;\n    }\n\n    function undefinedToNull(object) {\n        for (var property in object) {\n            if (object.hasOwnProperty(property)) {\n\n                // If an object, run through all its properties\n                if (Object.prototype.toString.call(object[property]) === '[object Object]') {\n                    undefinedToNull(object[property]);\n                }\n\n                // If an array, run through all items in the array\n                if (Object.prototype.toString.call(object[property]) === '[object Array]') {\n                    for (var obj in object[property]) {\n                        undefinedToNull(obj);\n                    }\n                }\n\n                // Otherwise, convert to null\n                if (object[property] === undefined) {\n                    object[property] = null;\n                }\n            }\n        }\n    }\n\n    function getChildrenElements(n, skipMe, type) {\n        // Get children elements from an HTML element\n        var r = [];\n        for (; n; n = n.nextSibling)\n            if (n.nodeType == 1 && n != skipMe)\n                if (type) {\n                    if (type.toUpperCase() == n.nodeName.toUpperCase()) {\n                        r.push(n);\n                    }\n                } else {\n                    r.push(n);\n                }\n        return r;\n    };\n\n    function getSiblingElements(n, type) {\n        // Get sibling elements from an HTML element, excluding self.\n        return getChildrenElements(n.parentNode.firstChild, n, type);\n    }\n    \n    function getCurrentIsoDate(atStartOfDay) {\n\n        var date = new Date();\n        \n        function pad(number) {\n            var r = String(number);\n            if (r.length === 1) {\n                r = '0' + r;\n            }\n            return r;\n        }\n        \n        var hours = \"00\";\n        var minutes = \"00\";\n        var seconds = \"00\"\n        \n        if (!atStartOfDay) {\n            hours = date.getUTCHours();\n            minutes = date.getUTCMinutes();\n            seconds = date.getUTCSeconds();\n        }\n\n        return date.getUTCFullYear() \n        + '-' + pad(date.getUTCMonth() + 1) \n        + '-' + pad(date.getUTCDate())\n        + 'T' + pad(hours) \n        + ':' + pad(minutes) \n        + ':' + pad(seconds) \n        + 'Z';\n    };\n    \n    function repeat(char, number) {\n        var e = \"\";\n        for (i = 0; i < number; i++) {\n            e += char;\n        }\n        return e;\n    }\n    \n    function mergeParams(params, required, expand) {\n        \n        // If you have a string, parse it into an object\n        if (_.isString(params)) {\n            params = parseQueryParameters(params);\n        }\n\n        // If null, set as an empty object\n        params = params || {};\n        \n        // Takes parameters, removes any hidden that are listed in required from the existing, adds any supplied expand parameters.\n\n        var currentHide = String((params.hide || \"\")).split(\",\");\n        var currentExpand = String((params.expand || \"\")).split(\",\");\n        \n        var newRequired = String((required || \"\")).split(\",\");\n        var newExpand = String((expand || \"\")).split(\",\");\n\n        // Remove items from hide that are in newRequired\n        currentHide = _.reject(currentHide, function (val) {\n            return (newRequired.indexOf(val) >= 0);\n        });\n        \n        // Concat expand\n        currentExpand = currentExpand.concat(newExpand);\n        currentExpand = _.uniq(currentExpand);\n\n        // Return\n        params.hide = currentHide.join(\",\");\n        params.expand = currentExpand.join(\",\");\n        \n        // Remove any leading or trailing commas\n        params.hide = TrimIf(params.hide, \",\");\n        params.expand = TrimIf(params.expand, \",\");\n\n        return params;\n\n    }\n    \n    function LeftTrimIf(str, char) {\n        if (str) {\n            if (str.substring(0, 1) == char) {\n                str = str.substring(1);\n            }\n        }\n        return str;\n    }\n    \n    function RightTrimIf(str, char) {\n        if (str) {\n            if (str.charAt(str.length - 1) == \"/\") {\n                str = str.substr(0, str.length - 1)\n            }\n        }\n        return str;\n    }\n    \n    function deDuplicateCsv(csv) {\n        var array = csv.split(',');\n        var unique = _.uniq(array);\n        return unique.join(\",\");\n    }\n    \n    function TrimIf(str, char) {\n        return (RightTrimIf(LeftTrimIf(str, char), char));\n    }\n    \n    function getLocale(language) {\n        \n        // Array of supported locales\n        var locales = [];\n        locales.push(\"af-na\", \"af-za\", \"af\", \"ar-ae\", \"ar-bh\", \"ar-dj\", \"ar-dz\", \"ar-eg\", \"ar-eh\", \"ar-er\", \"ar-il\", \"ar-iq\", \"ar-jo\", \"ar-km\", \"ar-kw\", \"ar-lb\", \"ar-ly\", \"ar-ma\", \"ar-mr\", \"ar-om\", \"ar-ps\", \"ar-qa\", \"ar-sa\", \"ar-sd\", \"ar-so\", \"ar-ss\", \"ar-sy\", \"ar-td\", \"ar-tn\", \"ar-ye\", \"ar\", \"az-cyrl-az\", \"az-cyrl\", \"az-latn-az\", \"az-latn\", \"az\", \"bg-bg\", \"bg\", \"bo-cn\", \"bo-in\", \"bo\", \"cs-cz\", \"cs\", \"da-dk\", \"da-gl\", \"da\", \"dav-ke\", \"dav\", \"de-at\", \"de-be\", \"de-ch\", \"de-de\", \"de-li\", \"de-lu\", \"de\", \"el-cy\", \"el-gr\", \"el\", \"en-ag\", \"en-ai\", \"en-as\", \"en-au\", \"en-bb\", \"en-be\", \"en-bm\", \"en-bs\", \"en-bw\", \"en-bz\", \"en-ca\", \"en-cc\", \"en-ck\", \"en-cm\", \"en-cx\", \"en-dg\", \"en-dm\", \"en-dsrt-us\", \"en-dsrt\", \"en-er\", \"en-fj\", \"en-fk\", \"en-fm\", \"en-gb\", \"en-gd\", \"en-gg\", \"en-gh\", \"en-gi\", \"en-gm\", \"en-gu\", \"en-gy\", \"en-hk\", \"en-ie\", \"en-im\", \"en-in\", \"en-io\", \"en-iso\", \"en-je\", \"en-jm\", \"en-ke\", \"en-ki\", \"en-kn\", \"en-ky\", \"en-lc\", \"en-lr\", \"en-ls\", \"en-mg\", \"en-mh\", \"en-mo\", \"en-mp\", \"en-ms\", \"en-mt\", \"en-mu\", \"en-mw\", \"en-na\", \"en-nf\", \"en-ng\", \"en-nr\", \"en-nu\", \"en-nz\", \"en-pg\", \"en-ph\", \"en-pk\", \"en-pn\", \"en-pr\", \"en-pw\", \"en-rw\", \"en-sb\", \"en-sc\", \"en-sd\", \"en-sg\", \"en-sh\", \"en-sl\", \"en-ss\", \"en-sx\", \"en-sz\", \"en-tc\", \"en-tk\", \"en-to\", \"en-tt\", \"en-tv\", \"en-tz\", \"en-ug\", \"en-um\", \"en-us\", \"en-vc\", \"en-vg\", \"en-vi\", \"en-vu\", \"en-ws\", \"en-za\", \"en-zm\", \"en-zw\", \"en\", \"es-ar\", \"es-bo\", \"es-cl\", \"es-co\", \"es-cr\", \"es-cu\", \"es-do\", \"es-ea\", \"es-ec\", \"es-es\", \"es-gq\", \"es-gt\", \"es-hn\", \"es-ic\", \"es-mx\", \"es-ni\", \"es-pa\", \"es-pe\", \"es-ph\", \"es-pr\", \"es-py\", \"es-sv\", \"es-us\", \"es-uy\", \"es-ve\", \"es\", \"et-ee\", \"et\", \"eu-es\", \"eu\", \"fa-af\", \"fa-ir\", \"fa\", \"fi-fi\", \"fi\", \"fil-ph\", \"fil\", \"fr-be\", \"fr-bf\", \"fr-bi\", \"fr-bj\", \"fr-bl\", \"fr-ca\", \"fr-cd\", \"fr-cf\", \"fr-cg\", \"fr-ch\", \"fr-ci\", \"fr-cm\", \"fr-dj\", \"fr-dz\", \"fr-fr\", \"fr-ga\", \"fr-gf\", \"fr-gn\", \"fr-gp\", \"fr-gq\", \"fr-ht\", \"fr-km\", \"fr-lu\", \"fr-ma\", \"fr-mc\", \"fr-mf\", \"fr-mg\", \"fr-ml\", \"fr-mq\", \"fr-mr\", \"fr-mu\", \"fr-nc\", \"fr-ne\", \"fr-pf\", \"fr-pm\", \"fr-re\", \"fr-rw\", \"fr-sc\", \"fr-sn\", \"fr-sy\", \"fr-td\", \"fr-tg\", \"fr-tn\", \"fr-vu\", \"fr-wf\", \"fr-yt\", \"fr\", \"hi-in\", \"hi\", \"hr-ba\", \"hr-hr\", \"hr\", \"hu-hu\", \"hu\", \"hy-am\", \"hy\", \"is-is\", \"is\", \"it-ch\", \"it-it\", \"it-sm\", \"it\", \"ja-jp\", \"ja\", \"ka-ge\", \"ka\", \"kab-dz\", \"kab\", \"kam-ke\", \"kam\", \"kk-cyrl-kz\", \"kk-cyrl\", \"kk\", \"kkj-cm\", \"kkj\", \"kl-gl\", \"kl\", \"kln-ke\", \"kln\", \"km-kh\", \"km\", \"ko-kp\", \"ko-kr\", \"ko\", \"kok-in\", \"kok\", \"lo-la\", \"lo\", \"lt-lt\", \"lt\", \"mg-mg\", \"mg\", \"mgh-mz\", \"mgh\", \"mgo-cm\", \"mgo\", \"mk-mk\", \"mk\", \"mn-cyrl-mn\", \"mn-cyrl\", \"mn\", \"ms-bn\", \"ms-latn-bn\", \"ms-latn-my\", \"ms-latn-sg\", \"ms-latn\", \"ms-my\", \"ms\", \"mt-mt\", \"mt\", \"ne-in\", \"ne-np\", \"ne\", \"nl-aw\", \"nl-be\", \"nl-bq\", \"nl-cw\", \"nl-nl\", \"nl-sr\", \"nl-sx\", \"nl\", \"no-no\", \"no\", \"pl-pl\", \"pl\", \"pt-ao\", \"pt-br\", \"pt-cv\", \"pt-gw\", \"pt-mo\", \"pt-mz\", \"pt-pt\", \"pt-st\", \"pt-tl\", \"pt\", \"ro-md\", \"ro-ro\", \"ro\", \"rof-tz\", \"rof\", \"ru-by\", \"ru-kg\", \"ru-kz\", \"ru-md\", \"ru-ru\", \"ru-ua\", \"ru\", \"shi-latn-ma\", \"shi-latn\", \"shi-tfng-ma\", \"shi-tfng\", \"shi\", \"sk-sk\", \"sk\", \"sl-si\", \"sl\", \"sq-al\", \"sq-mk\", \"sq-xk\", \"sq\", \"sr-cyrl-ba\", \"sr-cyrl-me\", \"sr-cyrl-rs\", \"sr-cyrl-xk\", \"sr-cyrl\", \"sr-latn-ba\", \"sr-latn-me\", \"sr-latn-rs\", \"sr-latn-xk\", \"sr-latn\", \"sr\", \"sv-ax\", \"sv-fi\", \"sv-se\", \"sv\", \"th-th\", \"th\", \"tl\", \"to-to\", \"to\", \"tr-cy\", \"tr-tr\", \"tr\", \"uk-ua\", \"uk\", \"uz-arab-af\", \"uz-arab\", \"uz-cyrl-uz\", \"uz-cyrl\", \"uz-latn-uz\", \"uz-latn\", \"uz\", \"vi-vn\", \"vi\", \"zh-cn\", \"zh-hans-cn\", \"zh-hans-hk\", \"zh-hans-mo\", \"zh-hans-sg\", \"zh-hans\", \"zh-hant-hk\", \"zh-hant-mo\", \"zh-hant-tw\", \"zh-hant\", \"zh-hk\", \"zh-tw\", \"zh\");\n        \n        // If their locale exists in the locale list, use it. Otherwise, use the locale from their selected language.\n        if (locales.indexOf(localStorage.getItem(\"locale\")) >= 0) {\n            return localStorage.getItem(\"locale\");\n        } else {\n            return language;\n        }\n\n    }\n\n    function cleanPrice(price) {\n        // Strip everything except numbers and decimals\n\n        if (typeof price === 'undefined' || price == null) {\n            return \"\";\n        }\n\n        var cleanedPrice = price.toString().replace(/[^0-9\\.\\s]/g, '').trim();\n\n        if (isNaN(cleanedPrice) == true || cleanedPrice.trim() == \"\") {\n            // The value is not reasonably close enough for it to be a valid price. Just return the original input.\n            return price;\n        } else {\n            // Truncate at two decimal places.\n            return parseFloat(cleanedPrice).toFixed(2);\n        }\n    }\n    \n    return {\n        setCookie: setCookie,\n        getCookie: getCookie,\n        deleteCookie: deleteCookie,\n        getPageHashParameters: getPageHashParameters,\n        getHashParameters: getHashParameters,\n        getPageQueryParameters: getPageQueryParameters,\n        getQueryParameters: getQueryParameters,\n        appendParams: appendParams,\n        left: left,\n        right: right,\n        isValidNumber: isValidNumber,\n        isValidInteger: isValidInteger,\n        getRandom: getRandom,\n        stringsToBool: stringsToBool,\n        stringToBool: stringToBool,\n        hasProperty: hasProperty,\n        areEqual: areEqual,\n        sumProperties: sumProperties,\n        isNullOrEmpty: isNullOrEmpty,\n        resetCookieExpiration: resetCookieExpiration,\n        removeWhitespace: removeWhitespace,\n        luhnCheck: luhnCheck,\n        undefinedToNull: undefinedToNull,\n        parseQueryParameters: parseQueryParameters,\n        isValidEmail: isValidEmail,\n        getChildrenElements: getChildrenElements,\n        getSiblingElements: getSiblingElements,\n        convert: convert,\n        getCurrentIsoDate: getCurrentIsoDate,\n        repeat: repeat,\n        mergeParams: mergeParams,\n        deDuplicateCsv: deDuplicateCsv,\n        getLocale: getLocale,\n        cleanPrice: cleanPrice\n    };\n\n})();\n\n// Prototypes\nString.prototype.replaceAll = function (f, r) {\n    return this.split(f).join(r);\n}\n\nvar app = angular.module(\"data-export\", ['ngRoute', 'ngAnimate', 'ngSanitize', 'ngFileSaver', 'ui.bootstrap', 'ui.bootstrap.tpls', 'angular-loading-bar', 'gettext', 'duScroll', 'tmh.dynamicLocale']);\n\napp.config(function ($httpProvider, $routeProvider, $locationProvider, $provide, cfpLoadingBarProvider, tmhDynamicLocaleProvider) {\n\n    // Configure the app routes\n    $routeProvider.when(\"/\", { templateUrl: \"app/pages/root.html\", controller: \"RootController\" });\n\n    // Loading bar https://github.com/chieffancypants/angular-loading-bar A global loading bar when HTTP requests are being made so you don't have to manually trigger spinners on each ajax call.\n    cfpLoadingBarProvider.latencyThreshold = 300;\n    cfpLoadingBarProvider.includeSpinner = false;\n\n    // Dynamically load locale files\n    tmhDynamicLocaleProvider.localeLocationPattern(\"https://cdnjs.cloudflare.com/ajax/libs/angular-i18n/1.4.8/angular-locale_{{locale}}.js\");\n\n});\n\napp.run(function ($rootScope) {\n\n    // There is another app.run function in run.js. This app.run is here for settings that apply to kit's direct implementation and wouldn't necessarily be done the same way by apps that consume kit.js.\n    // Only things that are not desirable to port into other apps should be here. Otherise you should use run.js.\n\n    // This defines the languages supported by the app. Each supported language must have an associated translation file in the languages folder. It ain't magic.\n    $rootScope.languages = [\n        {\n            code: \"en\",\n            name: \"English\"\n        },        \n        {\n            code: \"cs\",\n            name: \"čeština\"\n        },\n        {\n            code: \"de\",\n            name: \"Deutsche\"\n        },\n        {\n            code: \"el\",\n            name: \"Ελληνικά\"\n        },\n        {\n            code: \"es\",\n            name: \"Español\"\n        },                \n        {\n            code: \"fi\",\n            name: \"Suomalainen\"\n        },\n        {\n            code: \"fr\",\n            name: \"français\"\n        },            \n        {\n            code: \"it\",\n            name: \"italiano\"\n        },\n        {\n            code: \"ja\",\n            name: \"日本語\"\n        },\n        {\n            code: \"ko\",\n            name: \"한국어\"\n        },\n        {\n            code: \"nl\",\n            name: \"Nederlands\"\n        },\n        {\n            code: \"pl\",\n            name: \"Polskie\"\n        },\n        {\n            code: \"pt\",\n            name: \"Português\"\n        },\n        {\n            code: \"ru\",\n            name: \"русский\"\n        },            \n        {\n            code: \"sv\",\n            name: \"svenska\"\n        }\n    ]\n\n    // Analytics. Watch for route changes and load analytics accordingly.\n    $rootScope.$on('$locationChangeSuccess', function () {\n        if (window.__pageview && window.__pageview.recordPageLoad) {\n            window.__pageview.recordPageLoad();\n        }\n    });\n\n});\n\n// The following code needs to run after app.js and after utilities.js are loaded but before any directive, controller, etc. are run. This bootstraps the app at run time with the initial settings and configurations.\n\napp.run(function ($rootScope, $http, SettingsService, StorageService, LanguageService, ApiService) {\n\n        // Get the settings\n        var settings = SettingsService.get();\n\n        // Enable CORS when running in development environments.\n        if (settings.config.development) {\n            $http.defaults.useXDomain = true;\n        }\n\n    // Establish the app language\n        LanguageService.establishLanguage($rootScope.languagesPath);\n\n        // Establish the pageview load code. This is used to send Analytics data to the platform.\n        var loadPageview = function () {\n\n            // Find the pageview script in the DOM. If present, append the pageview analytics source to the page. Replace any previous to not pollute the page with each pageview.\n            var app_pageview = document.getElementById(\"app_pageview\");\n\n            if (app_pageview && settings.config.development != true) {\n                var head = document.getElementsByTagName(\"head\")[0];\n                var js = document.createElement(\"script\");\n                js.id = \"app_pageviewload\";\n                js.type = \"text/javascript\";\n                js.src = \"analytics/pageview.js\";\n\n                // Remove any existing\n                if (document.getElementById(\"app_pageviewload\") != null) {\n                    head.removeChild(document.getElementById(\"app_pageviewload\"));\n                }\n\n                // Add again to force reload.\n                head.appendChild(js);\n            }\n        }\n\n    });\n\n\napp.directive('updateIncludeFields', function () {\n  var linkFn = function (scope, element, attrs) {\n    var availableIncludes =  {\n      payments: [\n        {'value': 'fee_summary', 'label': 'Fee Summary'},\n      ],\n      refunds: [\n        {'value': 'payment', 'label': 'Payment'},\n        {'value': 'fee_summary', 'label': 'Fee Summary'},\n      ],\n      orders: [\n        {'value': 'customer', 'label': 'Customer'},\n        {'value': 'fee_summary', 'label': 'Fee Summary'},\n      ],\n      invoices: [\n        {'value': 'customer', 'label': 'Customer'},\n      ]\n    };\n\n    scope.toggleCheckbox = function(resource, field, value) {\n      if (angular.isUndefined(resource[field])) resource[field] = [];\n      var list = resource[field];\n      var idx = list.indexOf(value);\n      if (idx >= 0) {\n        list.splice(idx, 1);\n      } else {\n        list.push(value);\n      }\n    };\n\n    scope.$watch(function() {\n      return scope.options.dataset;\n    },function(newValue) {\n      scope.includes = [];\n      scope.options.expand = [];\n      if (angular.isDefined(availableIncludes[newValue])) {\n        scope.includes = availableIncludes[newValue];\n      }\n    });\n  };\n\n  return {\n    restrict: 'A',\n    scope: true,\n    link: linkFn\n  }\n});\n\napp.directive('displaySuccessField', function () {\n  var linkFn = function (scope, element, attrs) {\n    scope.$watch(function() {\n      return scope.options.dataset;\n    },function(newValue) {\n      switch(newValue) {\n        case 'payments':\n        case 'refunds':\n          element.css('display', 'inline');\n          scope.successValues = [\n            {'value': '', 'label': 'Any'},\n            {'value': 'true', 'label': 'True'},\n            {'value': 'false', 'label': 'False'}\n          ];\n          if (angular.isUndefined(scope.options.success)) scope.options.success = 'true';\n          break;\n        case 'invoices':\n        case 'orders':\n        case 'fees':\n        default:\n          delete scope.options['success'];\n          element.css('display', 'none');\n          scope.successValues = [];\n      };\n    });\n  };\n\n  return {\n    restrict: 'A',\n    scope: true,\n    link: linkFn\n  }\n});\n\napp.directive('updateStatusFields', function () {\n  var linkFn = function (scope, element, attrs) {\n    var defaultStatuses =  [\n      {'value': '', 'label': 'Any'},                // Export all\n      {'value': 'unpaid', 'label': 'Unpaid'},       // Used with Carts, Invoices\n      {'value': 'scheduled', 'label': 'scheduled'}, // Used with Invoices\n      {'value': 'initiated', 'label': 'initiated'}, // Used on Payments which are created but not authorized yet.\n      {'value': 'pending', 'label': 'pending'},     // Used with Payments, Carts, Invoices, Refunds, Orders\n      {'value': 'completed', 'label': 'completed'}, // Used with Payments, Carts, Invoices, Refunds, Orders\n      {'value': 'failed', 'label': 'failed'},       // Used with Payments, Carts, Invoices, Refunds\n      {'value': 'cancelled', 'label': 'cancelled'}, // Used with Payments, Carts, Invoices, Orders\n      {'value': 'refunded', 'label': 'refunded'},   // Used with Payments, Carts, Invoices, Orders\n      {'value': 'retry', 'label': 'retry'}          // Used with Payments, Invoices\n    ];\n\n    scope.$watch(function() {\n      return scope.options.dataset;\n    },function(newValue) {\n      newValue = 'DoNotDisplayForNow';\n      switch(newValue) {\n        case 'orders':\n          scope.options.statusField = 'payment_status';\n          scope.options.status = 'completed';\n          scope.statusesLabel = 'Payment Status';\n          scope.statuses = [\n            {'value': '', 'label': 'Any'},                // Export all\n            {'value': 'pending', 'label': 'pending'},     // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'completed', 'label': 'completed'}, // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'cancelled', 'label': 'cancelled'}, // Used with Payments, Carts, Invoices, Orders\n            {'value': 'refunded', 'label': 'refunded'}    // Used with Payments, Carts, Invoices, Orders\n          ];\n          break;\n        case 'invoices':\n          scope.options.statusField = 'payment_status';\n          scope.options.status = 'completed';\n          scope.statusesLabel = 'Payment Status';\n          scope.statuses = [\n            {'value': '', 'label': 'Any'},                // Export all\n            {'value': 'unpaid', 'label': 'Unpaid'},       // Used with Carts, Invoices\n            {'value': 'scheduled', 'label': 'scheduled'}, // Used with Invoices\n            {'value': 'pending', 'label': 'pending'},     // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'completed', 'label': 'completed'}, // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'failed', 'label': 'failed'},       // Used with Payments, Carts, Invoices, Refunds\n            {'value': 'cancelled', 'label': 'cancelled'}, // Used with Payments, Carts, Invoices, Orders\n            {'value': 'refunded', 'label': 'refunded'},   // Used with Payments, Carts, Invoices, Orders\n            {'value': 'retry', 'label': 'retry'}          // Used with Payments, Invoices\n          ];\n          break;\n        case 'payments':\n          scope.options.statusField = 'status';\n          scope.options.status = 'completed';\n          scope.statusesLabel = 'Status';\n          scope.statuses = [\n            {'value': '', 'label': 'Any'},                // Export all\n            {'value': 'initiated', 'label': 'initiated'}, // Used on Payments which are created but not authorized yet.\n            {'value': 'pending', 'label': 'pending'},     // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'completed', 'label': 'completed'}, // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'failed', 'label': 'failed'},       // Used with Payments, Carts, Invoices, Refunds\n            {'value': 'cancelled', 'label': 'cancelled'}, // Used with Payments, Carts, Invoices, Orders\n            {'value': 'refunded', 'label': 'refunded'},   // Used with Payments, Carts, Invoices, Orders\n            {'value': 'retry', 'label': 'retry'}          // Used with Payments, Invoices\n          ];\n          break;\n        case 'refunds':\n          scope.options.statusField = 'status';\n          scope.options.status = 'completed';\n          scope.statusesLabel = 'Status';\n          scope.statuses = [\n            {'value': '', 'label': 'Any'},                // Export all\n            {'value': 'pending', 'label': 'pending'},     // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'completed', 'label': 'completed'}, // Used with Payments, Carts, Invoices, Refunds, Orders\n            {'value': 'failed', 'label': 'failed'},       // Used with Payments, Carts, Invoices, Refunds\n          ];\n          break;\n        case 'fees':\n        default:\n          scope.options.statusField = '';\n          scope.options.status = '';\n          scope.statusLabel = '';\n          scope.statuses = [];\n      };\n    });\n  };\n\n  return {\n    restrict: 'A',\n    scope: true,\n    link: linkFn\n  }\n});\n\n\napp.factory('appCache', ['$cacheFactory', function ($cacheFactory) {\n  return $cacheFactory('appCache');\n}]);\n\napp.factory('fetchData', function (ApiService, $q, buildRootUrl) {\n  var _cancel = function(scope) {\n    if (angular.isFunction(scope.cancelFunc)) {\n      scope.cancelFunc();\n      scope.cancelFunc = undefined;\n      return true;\n    }\n    return false;\n  }\n\n  return function(scope, options, datepicker) {\n      var deferred = $q.defer();\n      var url = buildRootUrl(options, datepicker);\n      var success = null;\n      if ( angular.isDefined(options.success) && options.success.length) {\n        success = options.success == 'true';\n      }\n      var data = [];\n      scope.cancelFunc = scope.$watch(function() {\n        return url;\n      }, function(next) {\n        if (angular.isUndefined(next) || next == null) return;\n        ApiService.getList(next).then(\n          function(response) {\n            var d = response.data;\n            var next_page = d.next_page_url;\n            if (angular.isArray(d.data)) {\n              for (var i in d.data) {\n                var row = d.data[i];\n                if (typeof success == 'boolean') {\n                  if (success != row.success) continue;\n                }\n\n                data.push(row);\n              }\n            }\n            if (angular.isUndefined(next_page) || next_page == null) {\n              deferred.resolve(data);\n              _cancel(scope);\n              return;\n            }\n            url = next_page;\n          }, function(error) {\n            _cancel(scope);\n            deferred.reject(error);\n          }\n        );\n      });\n      return deferred.promise;\n    };\n  });\n\napp.factory('buildRootUrl', function($httpParamSerializer) {\n  return function(options, datepicker) {\n    var query = {\n      date_start: options.dates,\n      date_end: options.dates,\n      timezone: options.timezone\n    };\n\n    if (angular.isDefined(options.statusField) && angular.isDefined(options.status)) {\n      query[options.statusField] = options.status;\n    }\n\n    if (angular.isArray(options.expand) && options.expand.length) {\n      query['expand'] = options.expand.join(',');\n    } else if (angular.isString(options.expand) && options.expand.length) {\n      query['expand'] = options.expand;\n    }\n\n    // Override if necessary\n    switch(options.dates) {\n      case \"last_30\":\n        query.date_start = -29;\n        query.date_end = 0;\n        break;\n      case \"last_7\":\n        query.date_start = -6;\n        query.date_end = 0;\n        break;\n      case \"custom\":\n\n        if (!datepicker.date_end) datepicker.date_end = new Date();\n        if (!datepicker.date_start) datepicker.date_start = datepicker.date_end;\n\n        query.date_start = datepicker.date_start.toISOString().substring(0, 10);\n        query.date_end = datepicker.date_end.toISOString().substring(0, 10);\n        break;\n    }\n\n    return '/' + options.dataset + '?' + $httpParamSerializer(query);\n  };\n});\n\n\napp.factory('saveFile', function(FileSaver, Blob) {\n  return function(name, type, text) {\n    var data = new Blob([text], { type: type });\n    FileSaver.saveAs(data, name);\n  };\n});\n\napp.factory('toCSV', function() {\n  var doOrderFeeSummary = function(row) {\n    var item_subtotal = row['items.settlement_subtotal'];\n    var subtotal = row['settlement_subtotal'];\n    var fee_total = row['fee_summary.total']\n    row['fees'] = subtotal != 0.00 ? fee_total*item_subtotal/subtotal : 0.00;\n    row['fees_currency'] = row['fee_summary.currency'];\n    for(var key in row) {\n      if (key.match(/^fee_summary/)) delete row[key];\n    }\n  }\n  var doOrderCalcs = function(row, options) {\n    if (options.expand.indexOf('fee_summary') >= 0) {\n      doOrderFeeSummary(row);\n    }\n  }\n\n  var doCalcs = function(row, options) {\n    if (options.dataset == 'orders')\n      doOrderCalcs(row, options);\n  }\n\n  var mergeNestedObjects = function(parent) {\n    if (angular.isArray(parent) || !angular.isObject(parent)) return;\n    var keys = Object.keys(parent);\n    for (var k in keys) {\n      var key = keys[k];\n      mergeNestedObjects(parent[key]);\n    }\n\n    var keys1 = Object.keys(parent);\n    for (var k1 in keys1) {\n      var key1 = keys1[k1];\n      var value1 = parent[key1];\n      if (angular.isArray(value1) || !angular.isObject(value1)) continue;\n      var keys2 = Object.keys(value1);\n      for (var k2 in keys2) {\n        var key2 = keys2[k2];\n        var value2 = value1[key2];\n        parent[key1 + '.' + key2] = value2;\n      }\n      delete parent[key1];\n    }\n  };\n\n  var to_csv = function(data, options) {\n    var unraveled = [];\n    // Unravel items if present, otherwise just push object on to unraveled.\n    for (var i in data) {\n      var row = angular.copy(data[i]);\n      if (angular.isDefined(options.unravelField) && angular.isArray(row[options.unravelField])) {\n        var items = row[options.unravelField];\n        delete row[options.unravelField];\n        for (var j in items) {\n          var item = angular.copy(items[j]);\n          var keys = Object.keys(item);\n          for (var k in keys) {\n            var key = keys[k];\n            var value = item[key];\n            delete item[key];\n            item[ options.unravelField + '.' + key] = value;\n          }\n          unraveled.push(\n            angular.merge(item, row)\n          );\n        }\n      } else {\n        unraveled.push(row);\n      }\n    }\n\n    // Merge nested objects\n    for (var i in unraveled) {\n      mergeNestedObjects(unraveled[i]);\n    }\n\n    // Remove nested arrays and/or api urls.\n    for (var i in unraveled) {\n      var row = unraveled[i];\n      var keys = Object.keys(row);\n      for (var j in keys) {\n        var key = keys[j];\n        if (angular.isArray(row[key]) || key.match(/object$/)) {\n          delete row[key];\n          continue;\n        }\n\n        if (angular.isString(row[key]) && row[key].match(/\\/api\\/v1\\//)) {\n          delete row[key];\n          continue;\n        }\n\n        // remove T and Z from dates so excel treats as dates\n        if (key.match(/(_|\\b)date(_|\\b)/) && row[key]) {\n          row[key] = row[key].replace('T', ' ').replace('Z', '');\n        }\n      }\n\n      doCalcs(row, options);\n    }\n\n    return Papa.unparse(unraveled);\n  };\n  return to_csv;\n});\n\napp.service(\"TimezonesService\", [function () {\n\n    // Return public API.\n    return ({\n        getTimezones: getTimezones,\n    });\n\n    function getTimezones() {\n\n        var timezones = [\"Asia/China\", \"America/Alaska\", \"America/Atlantic_Time\", \"America/Arizona\", \"America/Central_Time\", \"America/Eastern_Time\", \"America/Hawaii\", \"America/Mountain_Time\", \"America/Newfoundland\", \"America/Pacific_Time\", \"Europe/Central\", \"Europe/Eastern\", \"Europe/GMT\", \"Africa/Abidjan\", \"Africa/Accra\", \"Africa/Addis_Ababa\", \"Africa/Algiers\", \"Africa/Asmara\", \"Africa/Asmera\", \"Africa/Bamako\", \"Africa/Bangui\", \"Africa/Banjul\", \"Africa/Bissau\", \"Africa/Blantyre\", \"Africa/Brazzaville\", \"Africa/Bujumbura\", \"Africa/Cairo\", \"Africa/Casablanca\", \"Africa/Ceuta\", \"Africa/Conakry\", \"Africa/Dakar\", \"Africa/Dar_es_Salaam\", \"Africa/Djibouti\", \"Africa/Douala\", \"Africa/El_Aaiun\", \"Africa/Freetown\", \"Africa/Gaborone\", \"Africa/Harare\", \"Africa/Johannesburg\", \"Africa/Kampala\", \"Africa/Khartoum\", \"Africa/Kigali\", \"Africa/Kinshasa\", \"Africa/Lagos\", \"Africa/Libreville\", \"Africa/Lome\", \"Africa/Luanda\", \"Africa/Lubumbashi\", \"Africa/Lusaka\", \"Africa/Malabo\", \"Africa/Maputo\", \"Africa/Maseru\", \"Africa/Mbabane\", \"Africa/Mogadishu\", \"Africa/Monrovia\", \"Africa/Nairobi\", \"Africa/Ndjamena\", \"Africa/Niamey\", \"Africa/Nouakchott\", \"Africa/Ouagadougou\", \"Africa/Porto-Novo\", \"Africa/Sao_Tome\", \"Africa/Timbuktu\", \"Africa/Tripoli\", \"Africa/Tunis\", \"Africa/Windhoek\", \"America/Adak\", \"America/Anchorage\", \"America/Anchorage\", \"America/Anguilla\", \"America/Antigua\", \"America/Araguaina\", \"America/Argentina/Buenos_Aires\", \"America/Argentina/Catamarca\", \"America/Argentina/ComodRivadavia\", \"America/Argentina/Cordoba\", \"America/Argentina/Jujuy\", \"America/Argentina/La_Rioja\", \"America/Argentina/Mendoza\", \"America/Argentina/Rio_Gallegos\", \"America/Argentina/Salta\", \"America/Argentina/San_Juan\", \"America/Argentina/San_Luis\", \"America/Argentina/Tucuman\", \"America/Argentina/Ushuaia\", \"America/Aruba\", \"America/Asuncion\", \"America/Atikokan\", \"America/Atka\", \"America/Bahia\", \"America/Barbados\", \"America/Belem\", \"America/Belize\", \"America/Blanc-Sablon\", \"America/Boa_Vista\", \"America/Bogota\", \"America/Boise\", \"America/Buenos_Aires\", \"America/Cambridge_Bay\", \"America/Campo_Grande\", \"America/Cancun\", \"America/Caracas\", \"America/Catamarca\", \"America/Cayenne\", \"America/Cayman\", \"America/Chicago\", \"America/Chicago\", \"America/Chihuahua\", \"America/Coral_Harbour\", \"America/Cordoba\", \"America/Costa_Rica\", \"America/Cuiaba\", \"America/Curacao\", \"America/Danmarkshavn\", \"America/Dawson\", \"America/Dawson_Creek\", \"America/Denver\", \"America/Denver\", \"America/Detroit\", \"America/Dominica\", \"America/Edmonton\", \"America/Eirunepe\", \"America/El_Salvador\", \"America/Ensenada\", \"America/Fort_Wayne\", \"America/Fortaleza\", \"America/Glace_Bay\", \"America/Godthab\", \"America/Goose_Bay\", \"America/Grand_Turk\", \"America/Grenada\", \"America/Guadeloupe\", \"America/Guatemala\", \"America/Guayaquil\", \"America/Guyana\", \"America/Halifax\", \"America/Havana\", \"America/Hermosillo\", \"America/Indiana/Indianapolis\", \"America/Indiana/Knox\", \"America/Indiana/Marengo\", \"America/Indiana/Petersburg\", \"America/Indiana/Tell_City\", \"America/Indiana/Vevay\", \"America/Indiana/Vincennes\", \"America/Indiana/Winamac\", \"America/Indianapolis\", \"America/Inuvik\", \"America/Iqaluit\", \"America/Jamaica\", \"America/Jujuy\", \"America/Juneau\", \"America/Kentucky/Louisville\", \"America/Kentucky/Monticello\", \"America/Knox_IN\", \"America/La_Paz\", \"America/Lima\", \"America/Los_Angeles\", \"America/Los_Angeles\", \"America/Louisville\", \"America/Maceio\", \"America/Managua\", \"America/Manaus\", \"America/Marigot\", \"America/Martinique\", \"America/Matamoros\", \"America/Mazatlan\", \"America/Mendoza\", \"America/Menominee\", \"America/Merida\", \"America/Mexico_City\", \"America/Miquelon\", \"America/Moncton\", \"America/Monterrey\", \"America/Montevideo\", \"America/Montreal\", \"America/Montserrat\", \"America/Nassau\", \"America/New_York\", \"America/New_York\", \"America/Nipigon\", \"America/Nome\", \"America/Noronha\", \"America/North_Dakota/Center\", \"America/North_Dakota/New_Salem\", \"America/Ojinaga\", \"America/Panama\", \"America/Pangnirtung\", \"America/Paramaribo\", \"America/Phoenix\", \"America/Phoenix\", \"America/Port_of_Spain\", \"America/Port-au-Prince\", \"America/Porto_Acre\", \"America/Porto_Velho\", \"America/Puerto_Rico\", \"America/Puerto_Rico\", \"America/Rainy_River\", \"America/Rankin_Inlet\", \"America/Recife\", \"America/Regina\", \"America/Resolute\", \"America/Rio_Branco\", \"America/Rosario\", \"America/Santa_Isabel\", \"America/Santarem\", \"America/Santiago\", \"America/Santo_Domingo\", \"America/Sao_Paulo\", \"America/Scoresbysund\", \"America/Shiprock\", \"America/St_Barthelemy\", \"America/St_Johns\", \"America/St_Kitts\", \"America/St_Lucia\", \"America/St_Thomas\", \"America/St_Vincent\", \"America/Swift_Current\", \"America/Tegucigalpa\", \"America/Thule\", \"America/Thunder_Bay\", \"America/Tijuana\", \"America/Toronto\", \"America/Tortola\", \"America/Vancouver\", \"America/Virgin\", \"America/Whitehorse\", \"America/Winnipeg\", \"America/Yakutat\", \"America/Yellowknife\", \"Antarctica/Casey\", \"Antarctica/Davis\", \"Antarctica/DumontDUrville\", \"Antarctica/Macquarie\", \"Antarctica/Mawson\", \"Antarctica/McMurdo\", \"Antarctica/Palmer\", \"Antarctica/Rothera\", \"Antarctica/South_Pole\", \"Antarctica/Syowa\", \"Antarctica/Vostok\", \"Arctic/Longyearbyen\", \"Asia/Aden\", \"Asia/Almaty\", \"Asia/Amman\", \"Asia/Anadyr\", \"Asia/Aqtau\", \"Asia/Aqtobe\", \"Asia/Ashgabat\", \"Asia/Ashkhabad\", \"Asia/Baghdad\", \"Asia/Bahrain\", \"Asia/Baku\", \"Asia/Bangkok\", \"Asia/Beirut\", \"Asia/Bishkek\", \"Asia/Brunei\", \"Asia/Calcutta\", \"Asia/Choibalsan\", \"Asia/Chongqing\", \"Asia/Chungking\", \"Asia/Colombo\", \"Asia/Dacca\", \"Asia/Damascus\", \"Asia/Dhaka\", \"Asia/Dili\", \"Asia/Dubai\", \"Asia/Dushanbe\", \"Asia/Gaza\", \"Asia/Harbin\", \"Asia/Ho_Chi_Minh\", \"Asia/Hong_Kong\", \"Asia/Hovd\", \"Asia/Irkutsk\", \"Asia/Istanbul\", \"Asia/Jakarta\", \"Asia/Jayapura\", \"Asia/Jerusalem\", \"Asia/Kabul\", \"Asia/Kamchatka\", \"Asia/Karachi\", \"Asia/Kashgar\", \"Asia/Kathmandu\", \"Asia/Katmandu\", \"Asia/Kolkata\", \"Asia/Krasnoyarsk\", \"Asia/Kuala_Lumpur\", \"Asia/Kuching\", \"Asia/Kuwait\", \"Asia/Macao\", \"Asia/Macau\", \"Asia/Magadan\", \"Asia/Makassar\", \"Asia/Manila\", \"Asia/Muscat\", \"Asia/Nicosia\", \"Asia/Novokuznetsk\", \"Asia/Novosibirsk\", \"Asia/Omsk\", \"Asia/Oral\", \"Asia/Phnom_Penh\", \"Asia/Pontianak\", \"Asia/Pyongyang\", \"Asia/Qatar\", \"Asia/Qyzylorda\", \"Asia/Rangoon\", \"Asia/Riyadh\", \"Asia/Saigon\", \"Asia/Sakhalin\", \"Asia/Samarkand\", \"Asia/Seoul\", \"Asia/Shanghai\", \"Asia/Singapore\", \"Asia/Taipei\", \"Asia/Tashkent\", \"Asia/Tbilisi\", \"Asia/Tehran\", \"Asia/Tel_Aviv\", \"Asia/Thimbu\", \"Asia/Thimphu\", \"Asia/Tokyo\", \"Asia/Ujung_Pandang\", \"Asia/Ulaanbaatar\", \"Asia/Ulan_Bator\", \"Asia/Urumqi\", \"Asia/Vientiane\", \"Asia/Vladivostok\", \"Asia/Yakutsk\", \"Asia/Yekaterinburg\", \"Asia/Yerevan\", \"Atlantic/Azores\", \"Atlantic/Bermuda\", \"Atlantic/Canary\", \"Atlantic/Cape_Verde\", \"Atlantic/Faeroe\", \"Atlantic/Faroe\", \"Atlantic/Jan_Mayen\", \"Atlantic/Madeira\", \"Atlantic/Reykjavik\", \"Atlantic/South_Georgia\", \"Atlantic/St_Helena\", \"Atlantic/Stanley\", \"Australia/ACT\", \"Australia/Adelaide\", \"Australia/Brisbane\", \"Australia/Broken_Hill\", \"Australia/Canberra\", \"Australia/Currie\", \"Australia/Darwin\", \"Australia/Eucla\", \"Australia/Hobart\", \"Australia/LHI\", \"Australia/Lindeman\", \"Australia/Lord_Howe\", \"Australia/Melbourne\", \"Australia/North\", \"Australia/NSW\", \"Australia/Perth\", \"Australia/Queensland\", \"Australia/South\", \"Australia/Sydney\", \"Australia/Tasmania\", \"Australia/Victoria\", \"Australia/West\", \"Australia/Yancowinna\", \"Europe/Amsterdam\", \"Europe/Andorra\", \"Europe/Athens\", \"Europe/Belfast\", \"Europe/Belgrade\", \"Europe/Berlin\", \"Europe/Bratislava\", \"Europe/Brussels\", \"Europe/Bucharest\", \"Europe/Budapest\", \"Europe/Chisinau\", \"Europe/Copenhagen\", \"Europe/Dublin\", \"Europe/Gibraltar\", \"Europe/Guernsey\", \"Europe/Helsinki\", \"Europe/Isle_of_Man\", \"Europe/Istanbul\", \"Europe/Jersey\", \"Europe/Kaliningrad\", \"Europe/Kiev\", \"Europe/Lisbon\", \"Europe/Ljubljana\", \"Europe/London\", \"Europe/Luxembourg\", \"Europe/Madrid\", \"Europe/Malta\", \"Europe/Mariehamn\", \"Europe/Minsk\", \"Europe/Monaco\", \"Europe/Moscow\", \"Europe/Nicosia\", \"Europe/Oslo\", \"Europe/Paris\", \"Europe/Podgorica\", \"Europe/Prague\", \"Europe/Riga\", \"Europe/Rome\", \"Europe/Samara\", \"Europe/San_Marino\", \"Europe/Sarajevo\", \"Europe/Simferopol\", \"Europe/Skopje\", \"Europe/Sofia\", \"Europe/Stockholm\", \"Europe/Tallinn\", \"Europe/Tirane\", \"Europe/Tiraspol\", \"Europe/Uzhgorod\", \"Europe/Vaduz\", \"Europe/Vatican\", \"Europe/Vienna\", \"Europe/Vilnius\", \"Europe/Volgograd\", \"Europe/Warsaw\", \"Europe/Zagreb\", \"Europe/Zaporozhye\", \"Europe/Zurich\", \"Indian/Antananarivo\", \"Indian/Chagos\", \"Indian/Christmas\", \"Indian/Cocos\", \"Indian/Comoro\", \"Indian/Kerguelen\", \"Indian/Mahe\", \"Indian/Maldives\", \"Indian/Mauritius\", \"Indian/Mayotte\", \"Indian/Reunion\", \"Pacific/Apia\", \"Pacific/Auckland\", \"Pacific/Chatham\", \"Pacific/Easter\", \"Pacific/Efate\", \"Pacific/Enderbury\", \"Pacific/Fakaofo\", \"Pacific/Fiji\", \"Pacific/Funafuti\", \"Pacific/Galapagos\", \"Pacific/Gambier\", \"Pacific/Guadalcanal\", \"Pacific/Guam\", \"Pacific/Honolulu\", \"Pacific/Honolulu\", \"Pacific/Johnston\", \"Pacific/Kiritimati\", \"Pacific/Kosrae\", \"Pacific/Kwajalein\", \"Pacific/Majuro\", \"Pacific/Marquesas\", \"Pacific/Midway\", \"Pacific/Nauru\", \"Pacific/Niue\", \"Pacific/Norfolk\", \"Pacific/Noumea\", \"Pacific/Pago_Pago\", \"Pacific/Palau\", \"Pacific/Pitcairn\", \"Pacific/Ponape\", \"Pacific/Port_Moresby\", \"Pacific/Rarotonga\", \"Pacific/Saipan\", \"Pacific/Samoa\", \"Pacific/Tahiti\", \"Pacific/Tarawa\", \"Pacific/Tongatapu\", \"Pacific/Truk\", \"Pacific/Wake\", \"Pacific/Wallis\", \"Pacific/Yap\", \"UTC\"];\n\n        return timezones;\n    }\n\n}]);\n\napp.service(\"ApiService\", ['$http', '$q', '$location', 'SettingsService', 'HelperService', 'StorageService', '$rootScope', 'gettextCatalog', function ($http, $q, $location, SettingsService, HelperService, StorageService, $rootScope, gettextCatalog) {\n\n    // Return public API.\n    return {\n        create: create,\n        getItem: getItem,\n        getList: getList,\n        update: update,\n        remove: remove,\n        getItemPdf: getItemPdf,\n        getToken: getToken,\n        getTokenExpiration: getTokenExpiration\n    };\n\n    function getTokenExpiration(expiresInSeconds) {\n\n        // The header response tells us when the cookie expires. Note that the expiration date slides, we'll update the token expiration with every API call.\n        var expiresInMinutes = 360; // 6 hours, default if for some reason we didn't get a header value.\n\n        if (expiresInSeconds != null && isNaN(expiresInSeconds) == false) {\n            expiresInMinutes = expiresInSeconds / 60;\n        }\n\n        // Subtract 5 minutes to ensure we'll be less than the server.\n        expiresInMinutes = expiresInMinutes - 10;\n\n        return expiresInMinutes;\n\n    }\n\n    function getToken() {\n\n        var deferred = $q.defer();\n\n        var token = StorageService.get(\"token\");\n\n        if (token != null) {\n            deferred.resolve(token);\n            return deferred.promise;\n        }\n\n        // The account_id is only needed in development environments. The hosted environment can call this endpoint without the account_id and it will be determined on the api side from the hostname.\n        var parameters = { browser_info: true };\n        var settings = SettingsService.get();\n\n        if (settings.account.account_id && settings.config.development == true) {\n            parameters = _.extend(parameters, { account_id: settings.account.account_id });\n        }\n\n        // Prepare the url\n        var endpoint = buildUrl(\"/auths/limited\", settings);\n\n        var request = $http({\n            ignoreLoadingBar: false,\n            method: \"post\",\n            url: endpoint + \"?timezone=UTC\",\n            params: parameters,\n            timeout: 15000,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n\n        // Get the token\n        request.then(function (response) {\n\n            StorageService.set(\"token\", response.data.token, response.headers(\"X-Token-Expires-In-Seconds\"));\n            StorageService.set(\"locale\", response.data.browser_info.locale);\n            StorageService.set(\"language\", response.data.browser_info.language);\n\n            // If you got a new token, delete any cart_id or invoice_id cookie. The new token won't be bound to them and letting them remain will cause a conflict when the new token tries to access a cart_id that it's not associated with.\n            StorageService.remove(\"cart_id\");\n            StorageService.remove(\"invoice_id\");\n\n            deferred.resolve(response.data.token);\n        }, function (error) {\n            deferred.reject({ type: \"internal_server_error\", reference: \"6lnOOW1\", code: \"unspecified_error\", message: \"There was a problem obtaining authorization for this session. Please reload the page to try your request again.\", status: error.status });\n        });\n\n        return deferred.promise;\n    }\n\n    function create(data, url, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        getToken().then(function (token) {\n\n            if (data == null) {\n                data = undefined;\n            }\n\n            // Get the settings\n            var settings = SettingsService.get();\n\n            // Prepare the url\n            var endpoint = buildUrl(url, settings);\n\n            // Timeout is high to handle payment requests that return slowly.\n            var request = $http({\n                ignoreLoadingBar: quiet,\n                method: \"post\",\n                data: angular.toJson(data),\n                url: endpoint + \"?timezone=UTC\",\n                params: parameters,\n                timeout: 65000,\n                headers: {\n                    \"Authorization\": \"Bearer \" + token,\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n\n            request.then(function (response) { onApiSuccess(response, deferred); }, function (error) { onApiError(error, deferred); });\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function getItem(url, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        getToken().then(function (token) {\n\n            // Get the settings\n            var settings = SettingsService.get();\n\n            // Prepare the url\n            var endpoint = buildUrl(url, settings);\n\n            var request = $http({\n                ignoreLoadingBar: quiet,\n                method: \"get\",\n                url: endpoint + \"?timezone=UTC\",\n                params: parameters,\n                timeout: 15000,\n                headers: {\n                    \"Authorization\": \"Bearer \" + token,\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n\n            request.then(function (response) { onApiSuccess(response, deferred); }, function (error) { onApiError(error, deferred); });\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function getList(url, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        getToken().then(function (token) {\n\n            // Get the settings\n            var settings = SettingsService.get();\n\n            // Prepare the url\n            var endpoint = buildUrl(url, settings);\n\n            // Parse the query parameters in the url\n            var queryParameters = utils.getQueryParameters(url);\n\n            // Remove any query parameters that are explicitly provided in parameters\n            _.each(parameters, function (item, index) {\n                if (queryParameters[index] != null) {\n                    delete queryParameters[index];\n                }\n            });\n\n            // Remove the current query string\n            if (url.indexOf(\"?\") > 0) {\n                url = url.substring(0, url.indexOf(\"?\"));\n            }\n\n            // Append the parameters\n            url = utils.appendParams(url, queryParameters);\n\n            var request = $http({\n                ignoreLoadingBar: quiet,\n                method: \"get\",\n                url: endpoint,\n                params: parameters,\n                timeout: 25000,\n                headers: {\n                    \"Authorization\": \"Bearer \" + token,\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n\n            request.then(function (response) { onApiSuccess(response, deferred); }, function (error) { onApiError(error, deferred); });\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function update(data, url, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        getToken().then(function (token) {\n\n            // Get the settings\n            var settings = SettingsService.get();\n\n            // Prepare the url\n            var endpoint = buildUrl(url, settings);\n\n            if (data == null) {\n                data = undefined;\n            }\n\n            var request = $http({\n                ignoreLoadingBar: quiet,\n                method: \"post\",\n                data: angular.toJson(slim(data)),\n                url: endpoint + \"?timezone=UTC\",\n                params: parameters,\n                timeout: 25000,\n                headers: {\n                    \"Authorization\": \"Bearer \" + token,\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n\n            request.then(function (response) { onApiSuccess(response, deferred); }, function (error) { onApiError(error, deferred); });\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function remove(url, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        getToken().then(function (token) {\n\n            // Get the settings\n            var settings = SettingsService.get();\n\n            // Prepare the url\n            var endpoint = buildUrl(url, settings);\n\n            var request = $http({\n                ignoreLoadingBar: quiet,\n                method: \"delete\",\n                url: endpoint + \"?timezone=UTC\",\n                params: parameters,\n                timeout: 15000,\n                headers: {\n                    \"Authorization\": \"Bearer \" + token,\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n\n            request.then(function (response) { onApiSuccess(response, deferred); }, function (error) { onApiError(error, deferred); });\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function getItemPdf(url, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        getToken().then(function (token) {\n\n            // Get the settings\n            var settings = SettingsService.get();\n\n            // Prepare the url\n            var endpoint = buildUrl(url, settings);\n\n            var request = $http({\n                ignoreLoadingBar: quiet,\n                method: \"get\",\n                url: endpoint + \"?timezone=UTC\",\n                params: parameters,\n                timeout: 15000,\n                responseType: \"arraybuffer\",\n                headers: {\n                    \"Authorization\": \"Bearer \" + token,\n                    \"Accept\": \"application/pdf\"\n                }\n            });\n\n            request.then(function (response) { onApiSuccess(response, deferred); }, function (error) { onApiError(error, deferred); });\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function buildUrl(endpoint, settings) {\n\n        // If the url is fully qualified, just return it.\n        if (endpoint.substring(0, 7) == \"http://\" || endpoint.substring(0, 8) == \"https://\") {\n            return endpoint;\n        } else {\n            // The api prefix will contain the fully qualified URL if you are running in development mode. The prefix is defined during the app's bootstrap.\n            return settings.config.apiPrefix + endpoint;\n        }\n\n    }\n\n    function slim(data) {\n\n        // Trim down the size of the payload\n        if (data != null && typeof data === 'object') {\n            var dataCopy = JSON.parse(JSON.stringify(data));\n\n            if (dataCopy.object == \"cart\") {\n                delete dataCopy.options;\n                delete dataCopy.shipping_item;\n                delete dataCopy.payments;\n                _.each(dataCopy.items, function (item) {\n                    delete item.subscription_terms;\n                    delete item.url;\n                    delete item.date_created;\n                    delete item.date_modified;\n                    delete item.formatted;\n                    delete item.product;\n                    delete item.subscription_plan;\n                });\n                delete dataCopy.customer.url;\n                delete dataCopy.customer.payments;\n                delete dataCopy.customer.refunds;\n                delete dataCopy.customer.orders;\n                delete dataCopy.customer.subscriptions;\n                delete dataCopy.customer.invoices;\n                delete dataCopy.promotion;\n            }\n\n            delete dataCopy.date_created;\n            delete dataCopy.date_modified;\n            delete dataCopy.object;\n            delete dataCopy.url;\n            delete dataCopy.test;\n            delete dataCopy.account_id;\n            delete dataCopy.formatted;\n        }\n\n        return dataCopy;\n\n    }\n\n    function onApiSuccess(response, defer) {\n\n        // Update the token expiration date\n        if (StorageService.get(\"token\")) {\n            StorageService.set(\"token\", StorageService.get(\"token\"), response.headers(\"X-Token-Expires-In-Seconds\"));\n        }\n\n        return defer.resolve(response);\n    }\n\n    function onApiError(response, defer) {\n\n        var error = {};\n\n        if (response.data) {\n            if (response.data.error) {\n                error = response.data.error;\n            }\n        }\n\n        var type;\n        var reference;\n        var code;\n        var message;\n\n        if (error) {\n\n            if (error.type) {\n                type = error.type;\n            }\n\n            if (error.code) {\n                code = error.code;\n            }\n\n            if (error.reference) {\n                reference = error.reference;\n            }\n\n            if (error.message) {\n                message = error.message;\n            }\n\n        }\n\n        // If your error is 401, then the token has died, or a login failure.\n        if (response.status == 401) {\n\n            // If the response code is invalid_login or account_locked, then don't get a new token. This is a failed login attempt and not a bad token.\n            if (code != \"invalid_login\" && code != \"account_locked\") {\n\n                // We'll do a full reset because the token is invalid and that means any associated cart_id is now orphaned.\n                HelperService.newSessionRedirect(true, \"Performing session reset due to invalid token in the cookie / request.\");\n            }\n        }\n\n        if (response.status == 403) {\n            message = \"There was a problem establishing your session. Please reload the page to try again.\";\n        }\n\n        // If you don't have an error.message, then you didn't receive a normalized error message from the server. This should not happen rarely but prevents the application from having to consider edge cases where an unexpected response format is returned.\n        if (!message) {\n\n            switch (response.status) {\n                case 404:\n                    type = \"not_found\";\n                    reference = \"4jnJPb7\";\n                    code = \"resource_not_found\";\n                    message = gettextCatalog.getString(\"The item you are trying to access could not be found.\");\n                    break;\n                default:\n                    type = \"internal_server_error\";\n                    reference = \"XEnf9FY\";\n                    code = \"unspecified_error\";\n                    message = gettextCatalog.getString(\"An error occured while attempting to process your request. Please try your request again. If the problem persists, please contact support.\");\n            }\n\n        }\n\n        error.type = type;\n        error.reference = reference;\n        error.code = code;\n        error.message = message;\n        error.status = response.status;\n\n        defer.reject(error);\n\n    }\n\n}]);\n\napp.service(\"CartService\", ['$http', '$q', '$rootScope', 'ApiService', 'PaymentService', 'SettingsService', 'HelperService', 'StorageService', function ($http, $q, $rootScope, ApiService, PaymentService, SettingsService, HelperService, StorageService) {\n\n    // Return public API.\n    return {\n        create: create,\n        get: get,\n        update: update,\n        addItem: addItem,\n        getItems: getItems,\n        pay: pay,\n        login: login,\n        logout: logout,\n        fromParams: fromParams\n    };\n\n    function create(data, parameters, quiet, fromParams) {\n\n        // The fromParams parameter indicates if this call is being made with a cart created from URL parameters.\n        // This helps determine how invalid promotion codes should be handled.\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        // If defined, set the currency\n        var currency = StorageService.get(\"currency\");\n        if (currency) {\n            data.currency = currency;\n        }\n\n        var url = \"/carts\";\n        ApiService.create(data, url, parameters, quiet).then(function (response) {\n            var cart = response.data;\n            // Set a cookie. The expiration date of this cookie will be the same as the token expiration, which we can get from the headers.\n            StorageService.set(\"cart_id\", cart.cart_id, response.headers(\"X-Token-Expires-In-Seconds\"));\n\n            // Set the display currency\n            syncCurrency(cart.currency);\n\n            deferred.resolve(cart);\n\n        }, function (error) {\n\n            // If the error is 400, the error code is \"invalid_promotion_code\" and the cart was built from URL parameters, replay the request without the promotion code.\n            // This allows a user to still create a cart when the URL contains an invalid embedded promotion code, although without a promotion. But it allows the order to continue.\n            if (error.code == \"invalid_promotion_code\" && fromParams) {\n                delete data.promotion_code;\n                create(data, parameters, quiet, false).then(function (response) {\n                    deferred.resolve(response);\n                }, function (error) {\n                    deferred.reject(error);\n                });\n            } else {\n                // Jus reject it\n                deferred.reject(error);\n            }\n        });\n\n        return deferred.promise;\n\n    }\n\n    function get(parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var cart_id = StorageService.get(\"cart_id\");\n\n        // Set up some stubs in the event of no cart or customer\n        var customerStub = { billing_address: {}, shipping_address: {} };\n        var cartStub = { items: [], customer: customerStub };\n\n        if (cart_id) {\n            var url = \"/carts/\" + cart_id;\n\n            ApiService.getItem(url, parameters, quiet).then(function (response) {\n                var cart = response.data;\n                // If the customer is null, set a stub\n                if (cart.customer == null) {\n                    cart.customer = customerStub;\n                }\n\n                // If the billing country is null, supply from the ip address\n                if (cart.customer.billing_address.country == null) {\n                    cart.customer.billing_address.country = cart.customer_ip_country;\n                }\n\n                // If the shiping country is null, supply from the ip address\n                if (cart.customer.shipping_address.country == null) {\n                    cart.customer.shipping_address.country = cart.customer_ip_country;\n                }\n\n                // In case it changed, sync the currency\n                syncCurrency(cart.currency);\n\n                deferred.resolve(cart);\n\n            }, function (error) {\n\n                // If 404, perform a session reset.\n                if (error.status == 404) {\n                    HelperService.newSessionRedirect(true, \"Performing a session reset due to an invalid cart_id in the cookie / request. (404 - cart not found)\");\n                }\n\n                deferred.reject(error);\n            });\n\n        } else {\n            // Return an empty cart. Build a stub object to make it easy to reference deep items even before a cart is created.\n            deferred.resolve(cartStub);\n        }\n\n        return deferred.promise;\n\n    }\n\n    function update(data, parameters, quiet, fromParams) {\n\n        // The fromParams parameter indicates if this call is being made with a cart created from URL parameters.\n        // This helps determine how invalid promotion codes should be handled.\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var cart_id = StorageService.get(\"cart_id\");\n\n        if (cart_id) {\n\n            var url = \"/carts/\" + cart_id;\n            ApiService.update(data, url, parameters, quiet).then(function (response) {\n\n                var cart = response.data;\n                // Update the cookie expiration date. The expiration date of this cookie will be the same as the token expiration, which we can get from the headers.\n                StorageService.set(\"cart_id\", cart.cart_id, response.headers(\"X-Token-Expires-In-Seconds\"));\n\n                // In case it changed, sync the currency\n                syncCurrency(cart.currency);\n\n                deferred.resolve(cart);\n\n            }, function (error) {\n\n                // If the error is 400, the error code is \"invalid_promotion_code\" and the cart was built from URL parameters, replay the request without the promotion code.\n                // This allows a user to still create a cart when the URL contains an invalid embedded promotion code, although without a promotion. But it allows the order to continue.\n                if (error.code == \"invalid_promotion_code\" && fromParams) {\n                    delete data.promotion_code;\n                    update(data, parameters, quiet, false).then(function (response) {\n                        deferred.resolve(response);\n                    }, function (error) {\n                        deferred.reject(error);\n                    });\n                } else {\n                    // If 404, perform a session reset.\n                    if (error.status == 404) {\n                        HelperService.newSessionRedirect(true, \"Performing a session reset due to an invalid cart_id in the cookie / request. (404 - cart not found)\");\n                    }\n\n                    // If invalid state, then the cart is already closed, perform a session reset.\n                    if (error.code == \"invalid_state\") {\n                        // Delete the cart_id as it can no longer be modified.\n                        StorageService.remove(\"cart_id\");\n                        HelperService.newSessionRedirect(false, \"Performing a cart_id reset due to an invalid cart_id in the cookie / request. (422 - invalid state): \" + error.message);\n                    }\n\n                    deferred.reject(error);\n\n                }\n\n            });\n\n            return deferred.promise;\n\n        } else {\n\n            // No cart exists. Create a new cart.\n            return create(data, parameters, quiet, fromParams);\n\n        }\n\n    }\n\n    function login(data, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var cart_id = StorageService.get(\"cart_id\");\n\n        var url = \"/carts/\" + cart_id + \"/login\";\n        ApiService.update(data, url, parameters, quiet).then(function (response) {\n\n            var cart = response.data;\n            // Update the cookie expiration date. The expiration date of this cookie will be the same as the token expiration, which we can get from the headers.\n            StorageService.set(\"cart_id\", cart.cart_id, response.headers(\"X-Token-Expires-In-Seconds\"));\n\n            // In case it changed, sync the currency\n            syncCurrency(cart.currency);\n\n            deferred.resolve(cart);\n\n        }, function (error) {\n\n            // If 404, perform a session reset.\n            if (error.status == 404) {\n                HelperService.newSessionRedirect(true, \"Performing a session reset due to an invalid cart_id in the cookie / request. (404 - cart not found)\");\n            }\n\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function logout(parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var cart_id = StorageService.get(\"cart_id\");\n\n        var url = \"/carts/\" + cart_id + \"/logout\";\n        ApiService.update(null, url, parameters, quiet).then(function (response) {\n\n            var cart = response.data;\n            // Update the cookie expiration date. The expiration date of this cookie will be the same as the token expiration, which we can get from the headers.\n            StorageService.set(\"cart_id\", cart.cart_id, response.headers(\"X-Token-Expires-In-Seconds\"));\n\n            // In case it changed, sync the currency\n            syncCurrency(cart.currency);\n\n            deferred.resolve(cart);\n\n        }, function (error) {\n\n            // If 404, perform a session reset.\n            if (error.status == 404) {\n                HelperService.newSessionRedirect(true, \"Performing a session reset due to an invalid cart_id in the cookie / request. (404 - cart not found)\");\n            }\n\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function addItem(data, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        if (data == null) {\n            deferred.reject({ type: \"bad_request\", reference: \"vbVcrcF\", code: \"invalid_input\", message: \"You must supply an item to add to the cart.\", status: 400 });\n            return deferred.promise;\n        }\n\n        parameters = setDefaultParameters(parameters);\n\n        // Get the cart.\n        get(parameters).then(function (cart) {\n\n            // Check if the cart has already been created.\n            if (cart.url) {\n                // Is the item in the cart?\n                var existingItem = _.findWhere(cart.items, data);\n\n                if (existingItem != null) {\n                    ApiService.update(data, existingItem.url, parameters, quiet).then(function (response) {\n\n                        var item = response.data;\n                        // In case it changed, sync the currency\n                        syncCurrency(item.currency);\n\n                        deferred.resolve(item);\n\n                    }, function (error) {\n                        deferred.reject(error);\n                    });\n                } else {\n                    // Add it\n                    ApiService.create(data, cart.url + \"/items\", parameters, quiet).then(function (response) {\n\n                        var item = response.data;\n                        // In case it changed, sync the currency\n                        syncCurrency(item.currency);\n\n                        deferred.resolve(item);\n\n                    }, function (error) {\n                        deferred.reject(error);\n                    });\n                }\n\n            } else {\n                // No cart created yet, create a cart with this item and send it.\n                cart.items.push(data);\n                create(cart, parameters, quiet).then(function (cart) {\n                    deferred.resolve(_.findWhere(cart.items, { item_id: data.product_id }));\n                }, function (error) {\n                    deferred.reject(error);\n                });\n            }\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function getItems(parameters, quiet) {\n\n        get(parameters, quiet).then(function (cart) {\n\n            // In case it changed, sync the currency\n            syncCurrency(cart.currency);\n\n            deferred.resolve(cart.items);\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function pay(cart, payment_method, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        // Define a function to send the payment, which happens after we create or update the cart.\n        var sendPayment = function (cart_id, payment_method) {\n\n            // Create the payment url\n            var url = \"/carts/\" + cart.cart_id + \"/payments\";\n\n            // Run the payment\n            PaymentService.create(payment_method, url, parameters, quiet).then(function (payment) {\n\n                // If the payment status is completed or the payment status is pending and the payment method is credit card, delete the cart_id. Attempting to interact with a closed cart (due to a successful payment) will result in errors.\n                if (payment.status == \"completed\" || payment.status == \"pending\") {\n                    StorageService.remove(\"cart_id\");\n                }\n\n                deferred.resolve(payment);\n\n            }, function (error) {\n                deferred.reject(error);\n            });\n        };\n\n        // If there currently is no cart, create it. Otherwise, update the existing cart.\n        if (cart.cart_id == null) {\n            create(cart, parameters, quiet).then(function (cart) {\n                sendPayment(cart.cart_id, payment_method);\n            }, function (error) {\n                deferred.reject(error);\n            });\n\n        } else {\n            update(cart, parameters, quiet).then(function (cart) {\n                sendPayment(cart.cart_id, payment_method);\n            }, function (error) {\n                deferred.reject(error);\n            });\n        }\n\n        return deferred.promise;\n\n    }\n\n    function fromParams(cart, location) {\n\n        // location should be the angular $location object\n\n        var params = location.search();\n\n        // We are looking for the following parameters. This can be exapnded at any time, as needed.\n        // product_id:xxxx, promotion_code, currency, name, email.\n\n        // If empty_cart is true, remove the items from the current cart.\n        if (utils.stringToBool(params.empty_cart)) {\n            cart.items = [];\n            location.search(\"empty_cart\", null);\n        }\n\n        // Find the product_ids\n        for (var property in params) {\n            if (params.hasOwnProperty(property)) {\n                if (utils.left(property, 11) == \"product_id:\") {\n\n                    var item = { product_id: property.substring(11) };\n                    if (utils.isValidInteger(params[property]) == false) {\n                        item.quantity = 1;\n                    } else {\n                        item.quantity = params[property];\n                    }\n\n                    // Remove the item if it already exists in the cart\n                    var existingItem = _.find(cart.items, function (i) { return i.product_id == item.product_id; });\n                    if (existingItem != null) {\n                        cart.items = _.reject(cart.items, function (i) { return i.product_id == item.product_id; });\n                    }\n\n                    // Set the item into the cart\n                    cart.items = cart.items || [];\n                    cart.items.push(item);\n                    location.search(property, null);\n\n                }\n            }\n        }\n\n        // Append the others\n        if (params.promotion_code) {\n            cart.promotion_code = params.promotion_code;\n            location.search(\"promotion_code\", null);\n        }\n\n        if (params.currency) {\n            cart.currency = params.currency;\n            location.search(\"currency\", null);\n        }\n\n        if (params.name) {\n            cart.customer.name = params.name;\n            location.search(\"name\", null);\n        }\n\n        if (params.email) {\n            if (utils.isValidEmail(params.email)) {\n                cart.customer.email = params.email;\n            }\n            location.search(\"email\", null);\n        }\n\n        if (params.referrer) {\n            cart.referrer = params.referrer;\n            location.search(\"referrer\", null);\n        }\n\n        if (params.affiliate_id) {\n            cart.affiliate_id = params.affiliate_id;\n            location.search(\"affiliate_id\", null);\n        }\n\n        // If there are no customer properties, delete the customer property\n        if (_.size(cart.customer) == 0) {\n            delete cart.customer;\n        }\n\n        // Append any other parameters as meta\n        params = location.search();\n\n        for (var property in params) {\n            if (params.hasOwnProperty(property)) {\n                if (cart.meta == null) {\n                    cart.meta = {};\n                }\n                cart.meta[property] = params[property];\n            }\n        }\n\n\n        return cart;\n\n    }\n\n    function syncCurrency(newCurrency) {\n\n        // This makes sure that the currency in cart payload responses automatically sync the stored currency value\n        var currentCurrency = StorageService.get(\"currency\");\n\n        if (newCurrency != currentCurrency) {\n\n            StorageService.set(\"currency\", newCurrency);\n\n            // Emit the change\n            $rootScope.$emit(\"currencyChanged\", newCurrency);\n        }\n    }\n\n    function setDefaultParameters(parameters, quiet) {\n\n        var parametersCopy = angular.copy(parameters);\n\n        // Cart is a complicated object and a lot of directives interact with it at the same time. As such, we don't allow the show parameter. Too likely toes will get stepped on.\n        if (parametersCopy) {\n            parametersCopy.formatted = true;\n            delete parametersCopy.show;\n            return parametersCopy;\n        } else {\n            return { formatted: true, options: true };\n        }\n\n    }\n\n}]);\n\napp.service(\"InvoiceService\", ['$http', '$q', '$rootScope', 'ApiService', 'PaymentService', 'SettingsService', 'HelperService', 'StorageService', '$location', function ($http, $q, $rootScope, ApiService, PaymentService, SettingsService, HelperService, StorageService, $location) {\n\n    // Return public API.\n    return {\n        get: get,\n        update: update,\n        pay: pay\n    };\n\n    function get(parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        // Get the invoice ID\n        var invoice_id = $location.search().invoice_id;\n        if (!invoice_id) {\n            invoice_id = StorageService.get(\"invoice_id\");\n        }\n\n        var url = \"/invoices/\" + invoice_id;\n\n        ApiService.getItem(url, parameters, quiet).then(function (response) {\n\n            var invoice = response.data;\n            StorageService.set(\"invoice_id\", invoice.invoice_id);\n\n            // In case it changed, sync the currency\n            syncCurrency(invoice.currency);\n\n            deferred.resolve(invoice);\n\n        }, function (error) {\n\n            // If 404, perform a redirect to base entry page. Don't perform a hard reset, just delete the invoice ID from storage and redirect. Also remove from the query string, if provided.\n            if (error.status == 404) {\n                $location.search(\"invoice_id\", null);\n                StorageService.remove(\"invoice_id\");\n                HelperService.newSessionRedirect(false, \"Performing a redirect due to an invalid invoice_id in the cookie / request. (404 - invoice not found)\");\n            }\n\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function update(data, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var invoice_id = StorageService.get(\"invoice_id\");\n\n        var url = \"/invoices/\" + invoice_id;\n        ApiService.update(data, url, parameters, quiet).then(function (response) {\n\n            var invoice = response.data;\n            // Update the cookie expiration date. The expiration date of this cookie will be the same as the token expiration, which we can get from the headers.\n            StorageService.set(\"invoice_id\", invoice.invoice_id, response.headers(\"X-Token-Expires-In-Seconds\"));\n\n            // In case it changed, sync the currency\n            syncCurrency(invoice.currency);\n\n            deferred.resolve(invoice);\n\n        }, function (error) {\n\n            // If 404, perform a session reset.\n            if (error.status == 404) {\n                HelperService.newSessionRedirect(true, \"Performing a session reset due to an invalid invoice_id in the cookie / request. (404 - invoice not found)\");\n            }\n\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function pay(invoice, payment_method, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        var sendPayment = function (invoice_id, payment_method) {\n\n            // Create the payment url\n            var url = \"/invoices/\" + invoice.invoice_id + \"/payments\";\n\n            // Run the payment\n            PaymentService.create(payment_method, url, parameters, quiet).then(function (payment) {\n\n                // If the payment is completed or pending, remove the invoice_id from the cookie.\n                if (payment.status == \"completed\" || payment.status == \"pending\") {\n                    StorageService.remove(\"invoice_id\");\n                }\n\n                deferred.resolve(payment);\n\n            }, function (error) {\n                deferred.reject(error);\n            });\n        };\n\n        // Send the payment.\n        sendPayment(invoice.invoice_id, payment_method);\n\n        return deferred.promise;\n\n    }\n\n    function syncCurrency(newCurrency) {\n\n        // This makes sure that the currency in invoice payload responses automatically sync the stored currency value\n        var currentCurrency = StorageService.get(\"currency\");\n\n        if (newCurrency != currentCurrency) {\n\n            StorageService.set(\"currency\", newCurrency);\n\n            // Emit the change\n            $rootScope.$emit(\"currencyChanged\", newCurrency);\n        }\n    }\n\n    function setDefaultParameters(parameters, quiet) {\n\n        var parametersCopy = angular.copy(parameters);\n\n        // Invoice is a complicated object and a lot of directives interact with it at the same time. As such, we don't allow the show parameter. Too likely toes will get stepped on.\n        if (parametersCopy) {\n            parametersCopy.formatted = true;\n            delete parametersCopy.show;\n            return parametersCopy;\n        } else {\n            return { formatted: true, options: true };\n        }\n\n    }\n\n}]);\n\napp.service(\"PaymentService\", ['$http', '$q', 'ApiService', 'SettingsService', 'StorageService', function ($http, $q, ApiService, SettingsService, StorageService) {\n\n    // Return public API.\n    return {\n        create: create,\n        createDirect: createDirect,\n        get: get,\n        update: update,\n        getOptions: getOptions,\n        commit: commit,\n        fromParams: fromParams\n    };\n\n    function create(payment_method, url, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        // Build the payment method object\n        var data = { payment_method: payment_method };\n\n        ApiService.create(data, url, parameters, quiet).then(function (response) {\n            var payment = response.data;\n            deferred.resolve(payment);\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function update(data, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        ApiService.update(data, \"/payments/\" + data.payment_id, parameters, quiet).then(function (response) {\n            var payment = response.data;\n            deferred.resolve(payment);\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function createDirect(payment, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var url = \"/payments\";\n\n        ApiService.create(payment, url, parameters, quiet).then(function (response) {\n            var result = response.data;\n            deferred.resolve(result);\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function get(payment_id, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        if (payment_id) {\n            var url = \"/payments/\" + payment_id;\n\n            ApiService.getItem(url, parameters, quiet).then(function (response) {\n                var payment = response.data;\n                deferred.resolve(payment);\n            }, function (error) {\n                deferred.reject(error);\n            });\n\n        } else {\n            deferred.reject({ \"type\": \"bad_request\", reference: \"HdPWrih\", code: \"invalid_input\", message: \"You request contained invalid data and could not be processed.\", status: 400 });\n            console.log(\"Your request for a payment must include a payment_id.\");\n        }\n\n        return deferred.promise;\n\n    }\n\n    function getOptions(parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        var url = \"/payments/options\";\n        ApiService.getItem(url, parameters, quiet).then(function (response) {\n            var options = response.data;\n            deferred.resolve(options);\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function commit(payment_id, parameters, quiet) {\n\n        // This is used for payment methods such as PayPal and Amazon Pay that need to be tiggered for completion after they have been reviewed by the customer.\n\n        var url = \"/payments/\" + payment_id + \"/commit\";\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        ApiService.create(null, url, parameters, quiet).then(function (response) {\n            var payment = response.data;\n\n            // If the payment status is completed or pending, delete the cart_id and / or invoice_id. Attempting to interact with a closed cart or invoice (due to a successful payment) will result in errors.\n            if (payment.status == \"completed\" || payment.status == \"pending\") {\n                StorageService.remove(\"cart_id\");\n                StorageService.remove(\"invoice_id\");\n            }\n\n            deferred.resolve(payment);\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n    function fromParams(payment, location) {\n\n        // Set payment as an object if null\n        payment = payment || {}\n\n        // location should be the angular $location object\n\n        // Make a copy so we can modify without changing the original params\n        var params = angular.copy(location.search());\n\n        // This is designed to be used for a \"hosted payment page\", where the customer makes an arbitrary payment not associated with a cart or invoice. Parameters such as amount, currency, description, reference and customer details can be passed as URL params.\n\n        if (params.currency) {\n            payment.currency = params.currency;\n            delete params.currency;\n            location.search(\"currency\", null);\n        }\n\n        if (params.total && utils.isValidNumber(params.total)) {\n            payment.total = params.total;\n            delete params.total;\n            location.search(\"total\", null);\n        }\n\n        // If the total is not supplied, look for subtotal, shipping, tax.\n        if (!payment.total) {\n\n            if (params.subtotal && utils.isValidNumber(params.subtotal)) {\n                payment.subtotal = params.subtotal;\n                delete params.subtotal;\n                location.search(\"subtotal\", null);\n            }\n\n            if (params.shipping && utils.isValidNumber(params.shipping)) {\n                payment.shipping = params.shipping;\n                delete params.shipping;\n                location.search(\"shipping\", null);\n            }\n\n            if (params.tax && utils.isValidNumber(params.tax)) {\n                payment.tax = params.tax;\n                delete params.tax;\n                location.search(\"tax\", null);\n            }\n\n        }\n\n        if (params.reference) {\n            payment.reference = params.reference;\n            delete params.reference;\n            location.search(\"reference\", null);\n        }\n\n        if (params.description) {\n            payment.description = params.description;\n            delete params.description;\n            location.search(\"description\", null);\n        }\n\n        payment.customer = payment.customer || {};\n\n        if (params.company_name) {\n            payment.customer.company_name = params.company_name;\n            delete params.company_name;\n        }\n\n        if (params.name) {\n            payment.customer.name = params.name;\n            delete params.name;\n        }\n\n        if (params.email) {\n            if (utils.isValidEmail(params.email)) {\n                payment.customer.email = params.email;\n            }\n            delete params.email;\n        }\n\n        if (params.referrer) {\n            payment.referrer = params.referrer;\n            delete params.referrer;\n        }\n\n        // Append any other parameters as meta\n        for (var property in params) {\n            if (params.hasOwnProperty(property)) {\n                if (payment.meta == null) {\n                    payment.meta = {};\n                }\n                payment.meta[property] = params[property];\n            }\n        }\n\n        return payment;\n\n    }\n\n    function setDefaultParameters(parameters, quiet) {\n\n        // Make sure the response data and payment method is expanded.\n        if (parameters) {\n\n            parameters.formatted = true;\n\n            if (parameters.expand == null) {\n                parameters.expand = \"response_data,payment_method\";\n            } else {\n                if (parameters.expand.indexOf(\"response_data\") == \"-1\") {\n                    parameters.expand += \",response_data\";\n                }\n                if (parameters.expand.indexOf(\"payment_method\") == \"-1\") {\n                    parameters.expand += \",payment_method\";\n                }\n            }\n\n            return parameters;\n\n        } else {\n\n            return { formatted: true, expand: \"response_data,payment_method\" };\n\n        }\n\n    }\n\n}]);\n\napp.service(\"OrderService\", ['$http', '$q', 'ApiService', function ($http, $q, ApiService) {\n\n    // Return public API.\n    return {\n        get: get\n    };\n\n    function get(order_id, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        if (order_id) {\n            var url = \"/orders/\" + order_id;\n\n            ApiService.getItem(url, parameters, quiet).then(function (response) {\n                var payment = response.data;\n                deferred.resolve(payment);\n            }, function (error) {\n                deferred.reject(error);\n            });\n\n        } else {\n            deferred.reject({ \"type\": \"bad_request\", reference: \"HdPWrih\", code: \"invalid_input\", message: \"The order you are trying to view cannot be found.\", status: 400 });\n            console.log(\"The order_id was not provided.\");\n        }\n\n        return deferred.promise;\n\n    }\n\n    function setDefaultParameters(parameters, quiet) {\n\n        if (parameters) {\n            parameters.formatted = true;\n            return parameters;\n        } else {\n            return { formatted: true };\n        }\n\n    }\n\n}]);\n\napp.service(\"CustomerService\", ['$http', '$q', 'ApiService', function ($http, $q, ApiService) {\n\n    // Return public API.\n    return {\n        createAccount: createAccount,\n        login: login\n    };\n\n    function createAccount(customer, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        if (customer.customer_id) {\n            var url = \"/customers/\" + customer.customer_id;\n\n            ApiService.update(customer, url, parameters, quiet).then(function (response) {\n                deferred.resolve(response.data);\n            }, function (error) {\n                deferred.reject(error);\n            });\n\n        } else {\n            deferred.reject({ \"type\": \"bad_request\", reference: \"8b1oMYs\", code: \"invalid_input\", message: \"The request could not be completed.\", status: 400 });\n            console.log(\"The customer object in the account creation request did not contain a customer_id.\");\n        }\n\n        return deferred.promise;\n\n    }\n\n    function login(data, parameters, quiet) {\n\n        var deferred = $q.defer();\n\n        var url = \"/customers/login\";\n        ApiService.create(data, url, parameters, quiet).then(function (response) {\n\n            var customer = response.data;\n            deferred.resolve(customer);\n\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n\n    }\n\n}]);\n\napp.service(\"ProductService\", ['$http', '$q', 'ApiService', 'CurrencyService', function ($http, $q, ApiService, CurrencyService) {\n\n    // Return public API.\n    return {\n        get: get,\n        getList: getList\n    };\n\n    function get(product_id, parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n\n        if (product_id) {\n            var url = \"/products/\" + product_id;\n\n            ApiService.getItem(url, parameters, quiet).then(function (response) {\n                var product = response.data;\n                // If the currency is not currently set, set it to the value of the returned product.\n                if (CurrencyService.getCurrency() == null) {\n                    CurrencyService.setCurrency(product.currency);\n                }\n\n                deferred.resolve(product);\n            }, function (error) {\n                deferred.reject(error);\n            });\n\n        } else {\n            deferred.reject({ \"type\": \"bad_request\", reference: \"IrUQTRv\", code: \"invalid_input\", message: \"The product you are trying to view cannot be found.\", status: 400 });\n            console.log(\"The product_id was not provided.\");\n        }\n\n        return deferred.promise;\n\n    }\n\n    function getList(parameters, quiet) {\n\n        var deferred = $q.defer();\n        parameters = setDefaultParameters(parameters);\n        var url = \"/products\";\n\n        ApiService.getList(url, parameters, quiet).then(function (response) {\n            var products = response.data;\n            // If the currency is not currently set, set it to the value of the returned product.\n            if (CurrencyService.getCurrency() == null) {\n                if (products.data[0]) {\n                    CurrencyService.setCurrency(products.data[0].currency);\n                }\n            }\n\n            deferred.resolve(products);\n        }, function (error) {\n            deferred.reject(error);\n        });\n\n        return deferred.promise;\n    }\n\n    function setDefaultParameters(parameters, quiet) {\n\n        if (parameters) {\n            parameters.formatted = true;\n            return parameters;\n        } else {\n            return { formatted: true };\n        }\n\n    }\n\n}]);\n\napp.service(\"GeoService\", [function () {\n\n    // Return public API.\n    return {\n        getData: getData,\n        getStatesProvs: getStatesProvs,\n        isEu: isEu,\n        getCurrencySymbol: getCurrencySymbol\n    };\n\n    function getData() {\n\n        var geo = {};\n\n        geo.countries = [{ name: 'Afghanistan', code: 'AF' }, { name: 'Albania', code: 'AL' }, { name: 'Algeria', code: 'DZ' }, { name: 'American Samoa', code: 'AS' }, { name: 'Andorra', code: 'AD' }, { name: 'Angola', code: 'AO' }, { name: 'Anguilla', code: 'AI' }, { name: 'Antarctica', code: 'AQ' }, { name: 'Antigua and Barbuda', code: 'AG' }, { name: 'Argentina', code: 'AR' }, { name: 'Armenia', code: 'AM' }, { name: 'Aruba', code: 'AW' }, { name: 'Australia', code: 'AU' }, { name: 'Austria', code: 'AT' }, { name: 'Azerbaijan', code: 'AZ' }, { name: 'Bahamas', code: 'BS' }, { name: 'Bahrain', code: 'BH' }, { name: 'Bangladesh', code: 'BD' }, { name: 'Barbados', code: 'BB' }, { name: 'Belarus', code: 'BY' }, { name: 'Belgium', code: 'BE' }, { name: 'Belize', code: 'BZ' }, { name: 'Benin', code: 'BJ' }, { name: 'Bermuda', code: 'BM' }, { name: 'Bhutan', code: 'BT' }, { name: 'Bolivia, Plurinational State of', code: 'BO' }, { name: 'Bonaire, Sint Eustatius and Saba', code: 'BQ' }, { name: 'Bosnia and Herzegovina', code: 'BA' }, { name: 'Botswana', code: 'BW' }, { name: 'Bouvet Island', code: 'BV' }, { name: 'Brazil', code: 'BR' }, { name: 'British Indian Ocean Territory', code: 'IO' }, { name: 'Brunei Darussalam', code: 'BN' }, { name: 'Bulgaria', code: 'BG' }, { name: 'Burkina Faso', code: 'BF' }, { name: 'Burundi', code: 'BI' }, { name: 'Cambodia', code: 'KH' }, { name: 'Cameroon', code: 'CM' }, { name: 'Canada', code: 'CA' }, { name: 'Cape Verde', code: 'CV' }, { name: 'Cayman Islands', code: 'KY' }, { name: 'Central African Republic', code: 'CF' }, { name: 'Chad', code: 'TD' }, { name: 'Chile', code: 'CL' }, { name: 'China', code: 'CN' }, { name: 'Christmas Island', code: 'CX' }, { name: 'Cocos (Keeling) Islands', code: 'CC' }, { name: 'Colombia', code: 'CO' }, { name: 'Comoros', code: 'KM' }, { name: 'Congo', code: 'CG' }, { name: 'Congo, the Democratic Republic of the', code: 'CD' }, { name: 'Cook Islands', code: 'CK' }, { name: 'Costa Rica', code: 'CR' }, { name: 'Cote d Ivoire', code: 'CI' }, { name: 'Croatia', code: 'HR' }, { name: 'Cuba', code: 'CU' }, { name: 'Curacao', code: 'CW' }, { name: 'Cyprus', code: 'CY' }, { name: 'Czech Republic', code: 'CZ' }, { name: 'Denmark', code: 'DK' }, { name: 'Djibouti', code: 'DJ' }, { name: 'Dominica', code: 'DM' }, { name: 'Dominican Republic', code: 'DO' }, { name: 'Ecuador', code: 'EC' }, { name: 'Egypt', code: 'EG' }, { name: 'El Salvador', code: 'SV' }, { name: 'Equatorial Guinea', code: 'GQ' }, { name: 'Eritrea', code: 'ER' }, { name: 'Estonia', code: 'EE' }, { name: 'Ethiopia', code: 'ET' }, { name: 'Falkland Islands', code: 'AX' }, { name: 'Falkland Islands (Malvinas)', code: 'FK' }, { name: 'Faroe Islands', code: 'FO' }, { name: 'Fiji', code: 'FJ' }, { name: 'Finland', code: 'FI' }, { name: 'France', code: 'FR' }, { name: 'French Guiana', code: 'GF' }, { name: 'French Polynesia', code: 'PF' }, { name: 'French Southern Territories', code: 'TF' }, { name: 'Gabon', code: 'GA' }, { name: 'Gambia', code: 'GM' }, { name: 'Georgia', code: 'GE' }, { name: 'Germany', code: 'DE' }, { name: 'Ghana', code: 'GH' }, { name: 'Gibraltar', code: 'GI' }, { name: 'Greece', code: 'GR' }, { name: 'Greenland', code: 'GL' }, { name: 'Grenada', code: 'GD' }, { name: 'Guadeloupe', code: 'GP' }, { name: 'Guam', code: 'GU' }, { name: 'Guatemala', code: 'GT' }, { name: 'Guernsey', code: 'GG' }, { name: 'Guinea', code: 'GN' }, { name: 'Guine Bissau', code: 'GW' }, { name: 'Guyana', code: 'GY' }, { name: 'Haiti', code: 'HT' }, { name: 'Heard Island and McDonald Islands', code: 'HM' }, { name: 'Holy See (Vatican City State)', code: 'VA' }, { name: 'Honduras', code: 'HN' }, { name: 'Hong Kong', code: 'HK' }, { name: 'Hungary', code: 'HU' }, { name: 'Iceland', code: 'IS' }, { name: 'India', code: 'IN' }, { name: 'Indonesia', code: 'ID' }, { name: 'Iran', code: 'IR' }, { name: 'Iraq', code: 'IQ' }, { name: 'Ireland', code: 'IE' }, { name: 'Isle of Man', code: 'IM' }, { name: 'Israel', code: 'IL' }, { name: 'Italy', code: 'IT' }, { name: 'Jamaica', code: 'JM' }, { name: 'Japan', code: 'JP' }, { name: 'Jersey', code: 'JE' }, { name: 'Jordan', code: 'JO' }, { name: 'Kazakhstan', code: 'KZ' }, { name: 'Kenya', code: 'KE' }, { name: 'Kiribati', code: 'KI' }, { name: 'Korea', code: 'KR' }, { name: 'Kuwait', code: 'KW' }, { name: 'Kyrgyzstan', code: 'KG' }, { name: 'Lao Peoples Democratic Republic', code: 'LA' }, { name: 'Latvia', code: 'LV' }, { name: 'Lebanon', code: 'LB' }, { name: 'Lesotho', code: 'LS' }, { name: 'Liberia', code: 'LR' }, { name: 'Libya', code: 'LY' }, { name: 'Liechtenstein', code: 'LI' }, { name: 'Lithuania', code: 'LT' }, { name: 'Luxembourg', code: 'LU' }, { name: 'Macao', code: 'MO' }, { name: 'Macedonia', code: 'MK' }, { name: 'Madagascar', code: 'MG' }, { name: 'Malawi', code: 'MW' }, { name: 'Malaysia', code: 'MY' }, { name: 'Maldives', code: 'MV' }, { name: 'Mali', code: 'ML' }, { name: 'Malta', code: 'MT' }, { name: 'Marshall Islands', code: 'MH' }, { name: 'Martinique', code: 'MQ' }, { name: 'Mauritania', code: 'MR' }, { name: 'Mauritius', code: 'MU' }, { name: 'Mayotte', code: 'YT' }, { name: 'Mexico', code: 'MX' }, { name: 'Micronesia', code: 'FM' }, { name: 'Moldova', code: 'MD' }, { name: 'Monaco', code: 'MC' }, { name: 'Mongolia', code: 'MN' }, { name: 'Montenegro', code: 'ME' }, { name: 'Montserrat', code: 'MS' }, { name: 'Morocco', code: 'MA' }, { name: 'Mozambique', code: 'MZ' }, { name: 'Myanmar', code: 'MM' }, { name: 'Namibia', code: 'NA' }, { name: 'Nauru', code: 'NR' }, { name: 'Nepal', code: 'NP' }, { name: 'Netherlands', code: 'NL' }, { name: 'New Caledonia', code: 'NC' }, { name: 'New Zealand', code: 'NZ' }, { name: 'Nicaragua', code: 'NI' }, { name: 'Niger', code: 'NE' }, { name: 'Nigeria', code: 'NG' }, { name: 'Niue', code: 'NU' }, { name: 'Norfolk Island', code: 'NF' }, { name: 'Northern Mariana Islands', code: 'MP' }, { name: 'Norway', code: 'NO' }, { name: 'Oman', code: 'OM' }, { name: 'Pakistan', code: 'PK' }, { name: 'Palau', code: 'PW' }, { name: 'Panama', code: 'PA' }, { name: 'Papua New Guinea', code: 'PG' }, { name: 'Paraguay', code: 'PY' }, { name: 'Peru', code: 'PE' }, { name: 'Philippines', code: 'PH' }, { name: 'Pitcairn', code: 'PN' }, { name: 'Poland', code: 'PL' }, { name: 'Portugal', code: 'PT' }, { name: 'Puerto Rico', code: 'PR' }, { name: 'Qatar', code: 'QA' }, { name: 'Reunion', code: 'RE' }, { name: 'Romania', code: 'RO' }, { name: 'Russian Federation', code: 'RU' }, { name: 'Rwanda', code: 'RW' }, { name: 'Saint Barthélemy', code: 'BL' }, { name: 'Saint Helena', code: 'SH' }, { name: 'Saint Kitts and Nevis', code: 'KN' }, { name: 'Saint Lucia', code: 'LC' }, { name: 'Saint Martin French', code: 'MF' }, { name: 'Saint Pierre and Miquelon', code: 'PM' }, { name: 'Saint Vincent and the Grenadines', code: 'VC' }, { name: 'Samoa', code: 'WS' }, { name: 'San Marino', code: 'SM' }, { name: 'Sao Tome and Principe', code: 'ST' }, { name: 'Saudi Arabia', code: 'SA' }, { name: 'Senegal', code: 'SN' }, { name: 'Serbia', code: 'RS' }, { name: 'Seychelles', code: 'SC' }, { name: 'Sierra Leone', code: 'SL' }, { name: 'Singapore', code: 'SG' }, { name: 'Sint Maarten Dutch', code: 'SX' }, { name: 'Slovakia', code: 'SK' }, { name: 'Slovenia', code: 'SI' }, { name: 'Solomon Islands', code: 'SB' }, { name: 'Somalia', code: 'SO' }, { name: 'South Africa', code: 'ZA' }, { name: 'South Sudan', code: 'SS' }, { name: 'Spain', code: 'ES' }, { name: 'Sri Lanka', code: 'LK' }, { name: 'Sudan', code: 'SD' }, { name: 'Suriname', code: 'SR' }, { name: 'Svalbard and Jan Mayen', code: 'SJ' }, { name: 'Swaziland', code: 'SZ' }, { name: 'Sweden', code: 'SE' }, { name: 'Switzerland', code: 'CH' }, { name: 'Syrian Arab Republic', code: 'SY' }, { name: 'Taiwan', code: 'TW' }, { name: 'Tajikistan', code: 'TJ' }, { name: 'Tanzania', code: 'TZ' }, { name: 'Thailand', code: 'TH' }, { name: 'Timor Leste', code: 'TL' }, { name: 'Togo', code: 'TG' }, { name: 'Tokelau', code: 'TK' }, { name: 'Tonga', code: 'TO' }, { name: 'Trinidad and Tobago', code: 'TT' }, { name: 'Tunisia', code: 'TN' }, { name: 'Turkey', code: 'TR' }, { name: 'Turkmenistan', code: 'TM' }, { name: 'Turks and Caicos Islands', code: 'TC' }, { name: 'Tuvalu', code: 'TV' }, { name: 'Uganda', code: 'UG' }, { name: 'Ukraine', code: 'UA' }, { name: 'United Arab Emirates', code: 'AE' }, { name: 'United Kingdom', code: 'GB' }, { name: 'United States', code: 'US' }, { name: 'United States Minor Outlying Islands', code: 'UM' }, { name: 'Uruguay', code: 'UY' }, { name: 'Uzbekistan', code: 'UZ' }, { name: 'Vanuatu', code: 'VU' }, { name: 'Venezuela', code: 'VE' }, { name: 'Viet Nam', code: 'VN' }, { name: 'Virgin Islands British', code: 'VG' }, { name: 'Virgin Islands U.S.', code: 'VI' }, { name: 'Wallis and Futuna', code: 'WF' }, { name: 'Western Sahara', code: 'EH' }, { name: 'Yemen', code: 'YE' }, { name: 'Zambia', code: 'ZM' }, { name: 'Zimbabwe', code: 'ZW' }];\n        geo.usStates = [{ name: \"Alabama\", code: \"AL\" }, { name: \"Alaska\", code: \"AK\" }, { name: \"American Samoa\", code: \"AS\" }, { name: \"Arizona\", code: \"AZ\" }, { name: \"Arkansas\", code: \"AR\" }, { name: \"California\", code: \"CA\" }, { name: \"Colorado\", code: \"CO\" }, { name: \"Connecticut\", code: \"CT\" }, { name: \"Delaware\", code: \"DE\" }, { name: \"District Of Columbia\", code: \"DC\" }, { name: \"Federated States Of Micronesia\", code: \"FM\" }, { name: \"Florida\", code: \"FL\" }, { name: \"Georgia\", code: \"GA\" }, { name: \"Guam\", code: \"GU\" }, { name: \"Hawaii\", code: \"HI\" }, { name: \"Idaho\", code: \"ID\" }, { name: \"Illinois\", code: \"IL\" }, { name: \"Indiana\", code: \"IN\" }, { name: \"Iowa\", code: \"IA\" }, { name: \"Kansas\", code: \"KS\" }, { name: \"Kentucky\", code: \"KY\" }, { name: \"Louisiana\", code: \"LA\" }, { name: \"Maine\", code: \"ME\" }, { name: \"Marshall Islands\", code: \"MH\" }, { name: \"Maryland\", code: \"MD\" }, { name: \"Massachusetts\", code: \"MA\" }, { name: \"Michigan\", code: \"MI\" }, { name: \"Minnesota\", code: \"MN\" }, { name: \"Mississippi\", code: \"MS\" }, { name: \"Missouri\", code: \"MO\" }, { name: \"Montana\", code: \"MT\" }, { name: \"Nebraska\", code: \"NE\" }, { name: \"Nevada\", code: \"NV\" }, { name: \"New Hampshire\", code: \"NH\" }, { name: \"New Jersey\", code: \"NJ\" }, { name: \"New Mexico\", code: \"NM\" }, { name: \"New York\", code: \"NY\" }, { name: \"North Carolina\", code: \"NC\" }, { name: \"North Dakota\", code: \"ND\" }, { name: \"Northern Mariana Islands\", code: \"MP\" }, { name: \"Ohio\", code: \"OH\" }, { name: \"Oklahoma\", code: \"OK\" }, { name: \"Oregon\", code: \"OR\" }, { name: \"Palau\", code: \"PW\" }, { name: \"Pennsylvania\", code: \"PA\" }, { name: \"Puerto Rico\", code: \"PR\" }, { name: \"Rhode Island\", code: \"RI\" }, { name: \"South Carolina\", code: \"SC\" }, { name: \"South Dakota\", code: \"SD\" }, { name: \"Tennessee\", code: \"TN\" }, { name: \"Texas\", code: \"TX\" }, { name: \"Utah\", code: \"UT\" }, { name: \"Vermont\", code: \"VT\" }, { name: \"Virgin Islands\", code: \"VI\" }, { name: \"Virginia\", code: \"VA\" }, { name: \"Washington\", code: \"WA\" }, { name: \"West Virginia\", code: \"WV\" }, { name: \"Wisconsin\", code: \"WI\" }, { name: \"Wyoming\", code: \"WY\" }, { name: \"U.S. Armed Forces Americas\", code: \"AA\" }, { name: \"U.S. Armed Forces Europe\", code: \"AE\" }, { name: \"U.S. Armed Forces Pacific\", code: \"AP\" }];\n        geo.caProvinces = [{ code: \"AB\", name: \"Alberta\" }, { code: \"BC\", name: \"British Columbia\" }, { code: \"LB\", name: \"Labrador\" }, { code: \"MB\", name: \"Manitoba\" }, { code: \"NB\", name: \"New Brunswick\" }, { code: \"NL\", name: \"Newfoundland\" }, { code: \"NS\", name: \"Nova Scotia\" }, { code: \"NU\", name: \"Nunavut\" }, { code: \"NW\", name: \"Northwest Territories\" }, { code: \"ON\", name: \"Ontario\" }, { code: \"PE\", name: \"Prince Edward Island\" }, { code: \"QC\", name: \"Quebec\" }, { code: \"SK\", name: \"Saskatchewen\" }, { code: \"YT\", name: \"Yukon\" }];\n\n        return geo;\n    }\n\n    function getStatesProvs(country) {\n\n        var data = getData();\n\n        if (country == \"US\") {\n            return data.usStates;\n        }\n\n        if (country == \"CA\") {\n            return data.caProvinces;\n        }\n\n        return null;\n\n    }\n\n    function isEu(country) {\n\n        var euCountries = [\"AT\", \"BE\", \"BG\", \"HR\", \"CY\", \"CZ\", \"DK\", \"EE\", \"FI\", \"FR\", \"DE\", \"GR\", \"HU\", \"IE\", \"IT\", \"LV\", \"LT\", \"LU\", \"MT\", \"NL\", \"PL\", \"PT\", \"RO\", \"SK\", \"SI\", \"ES\", \"SE\", \"GB\"];\n\n        if (euCountries.indexOf(country) > -1) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n    function getCurrencySymbol(code) {\n\n        var currencies = { \"AED\": \"د.إ\", \"AFN\": \"؋\", \"ALL\": \"L\", \"AMD\": \"֏\", \"ANG\": \"ƒ\", \"AOA\": \"Kz\", \"ARS\": \"$\", \"AUD\": \"$\", \"AWG\": \"ƒ\", \"AZN\": \"ман\", \"BAM\": \"KM\", \"BBD\": \"$\", \"BDT\": \"৳\", \"BGN\": \"лв\", \"BHD\": \".د.ب\", \"BIF\": \"FBu\", \"BMD\": \"$\", \"BND\": \"$\", \"BOB\": \"$b\", \"BRL\": \"R$\", \"BSD\": \"$\", \"BTC\": \"฿\", \"BTN\": \"Nu.\", \"BWP\": \"P\", \"BYR\": \"p.\", \"BZD\": \"BZ$\", \"CAD\": \"$\", \"CDF\": \"FC\", \"CHF\": \"CHF\", \"CLP\": \"$\", \"CNY\": \"¥\", \"COP\": \"$\", \"CRC\": \"₡\", \"CUC\": \"$\", \"CUP\": \"₱\", \"CVE\": \"$\", \"CZK\": \"Kč\", \"DJF\": \"Fdj\", \"DKK\": \"kr\", \"DOP\": \"RD$\", \"DZD\": \"دج\", \"EEK\": \"kr\", \"EGP\": \"£\", \"ERN\": \"Nfk\", \"ETB\": \"Br\", \"ETH\": \"Ξ\", \"EUR\": \"€\", \"FJD\": \"$\", \"FKP\": \"£\", \"GBP\": \"£\", \"GEL\": \"₾\", \"GGP\": \"£\", \"GHC\": \"₵\", \"GHS\": \"GH₵\", \"GIP\": \"£\", \"GMD\": \"D\", \"GNF\": \"FG\", \"GTQ\": \"Q\", \"GYD\": \"$\", \"HKD\": \"$\", \"HNL\": \"L\", \"HRK\": \"kn\", \"HTG\": \"G\", \"HUF\": \"Ft\", \"IDR\": \"Rp\", \"ILS\": \"₪\", \"IMP\": \"£\", \"INR\": \"₹\", \"IQD\": \"ع.د\", \"IRR\": \"﷼\", \"ISK\": \"kr\", \"JEP\": \"£\", \"JMD\": \"J$\", \"JOD\": \"JD\", \"JPY\": \"¥\", \"KES\": \"KSh\", \"KGS\": \"лв\", \"KHR\": \"៛\", \"KMF\": \"CF\", \"KPW\": \"₩\", \"KRW\": \"₩\", \"KWD\": \"KD\", \"KYD\": \"$\", \"KZT\": \"лв\", \"LAK\": \"₭\", \"LBP\": \"£\", \"LKR\": \"₨\", \"LRD\": \"$\", \"LSL\": \"M\", \"LTC\": \"Ł\", \"LTL\": \"Lt\", \"LVL\": \"Ls\", \"LYD\": \"LD\", \"MAD\": \"MAD\", \"MDL\": \"lei\", \"MGA\": \"Ar\", \"MKD\": \"ден\", \"MMK\": \"K\", \"MNT\": \"₮\", \"MOP\": \"MOP$\", \"MRO\": \"UM\", \"MUR\": \"₨\", \"MVR\": \"Rf\", \"MWK\": \"MK\", \"MXN\": \"$\", \"MYR\": \"RM\", \"MZN\": \"MT\", \"NAD\": \"$\", \"NGN\": \"₦\", \"NIO\": \"C$\", \"NOK\": \"kr\", \"NPR\": \"₨\", \"NZD\": \"$\", \"OMR\": \"﷼\", \"PAB\": \"B/.\", \"PEN\": \"S/.\", \"PGK\": \"K\", \"PHP\": \"₱\", \"PKR\": \"₨\", \"PLN\": \"zł\", \"PYG\": \"Gs\", \"QAR\": \"﷼\", \"RMB\": \"￥\", \"RON\": \"lei\", \"RSD\": \"Дин.\", \"RUB\": \"₽\", \"RWF\": \"R₣\", \"SAR\": \"﷼\", \"SBD\": \"$\", \"SCR\": \"₨\", \"SDG\": \"ج.س.\", \"SEK\": \"kr\", \"SGD\": \"$\", \"SHP\": \"£\", \"SLL\": \"Le\", \"SOS\": \"S\", \"SRD\": \"$\", \"SSP\": \"£\", \"STD\": \"Db\", \"SVC\": \"$\", \"SYP\": \"£\", \"SZL\": \"E\", \"THB\": \"฿\", \"TJS\": \"SM\", \"TMT\": \"T\", \"TND\": \"د.ت\", \"TOP\": \"T$\", \"TRL\": \"₤\", \"TRY\": \"₺\", \"TTD\": \"TT$\", \"TVD\": \"$\", \"TWD\": \"NT$\", \"TZS\": \"TSh\", \"UAH\": \"₴\", \"UGX\": \"USh\", \"USD\": \"$\", \"UYU\": \"$U\", \"UZS\": \"лв\", \"VEF\": \"Bs\", \"VND\": \"₫\", \"VUV\": \"VT\", \"WST\": \"WS$\", \"XAF\": \"FCFA\", \"XBT\": \"Ƀ\", \"XCD\": \"$\", \"XOF\": \"CFA\", \"XPF\": \"₣\", \"YER\": \"﷼\", \"ZAR\": \"R\", \"ZWD\": \"Z$\" }\n\n        return currencies[code] || \"\";\n    }\n\n}]);\n\napp.service(\"CurrencyService\", ['$q', '$rootScope', 'SettingsService', 'CartService', 'InvoiceService', 'StorageService', 'ApiService', function ($q, $rootScope, SettingsService, CartService, InvoiceService, StorageService, ApiService) {\n\n    // Return public API.\n    return {\n        getCurrency: getCurrency,\n        getCurrencyName: getCurrencyName,\n        setCurrency: setCurrency\n    };\n\n    function getCurrency() {\n        return StorageService.get(\"currency\");\n    }\n\n    function getCurrencyName() {\n\n        var code = getCurrency();\n        var settings = SettingsService.get();\n\n        var name = null;\n        _.each(settings.account.currencies, function (item) {\n            if (item.code == code) {\n                name = item.name;\n            }\n        });\n\n        return name;\n\n    }\n\n    function setCurrency(newValue) {\n\n        // Store in a cookie to persist page refreshes\n        StorageService.set(\"currency\", newValue);\n\n        // Emit the change\n        $rootScope.$emit(\"currencyChanged\", newValue);\n\n    }\n\n}]);\n\napp.service(\"LanguageService\", ['$q', '$rootScope', 'SettingsService', 'StorageService', 'gettextCatalog', 'ApiService', function ($q, $rootScope, SettingsService, StorageService, gettextCatalog, ApiService) {\n\n    // Angular gettext https://angular-gettext.rocketeer.be/ Used to provide application translations. Translation files are located in the languages folder.\n\n    // Return public API.\n    return {\n        getSelectedLanguage: getSelectedLanguage,\n        getLanguages: getLanguages,\n        setLanguage: setLanguage,\n        establishLanguage: establishLanguage\n    };\n\n    function getLanguages() {\n\n        // The supported languages are defined in rootScope. This allows the setting to be changed by apps that use kit don't want to modify kit's source.\n        if ($rootScope.languages) {\n            return $rootScope.languages;\n        } else {\n            // Return the default language\n            return [{ code: \"en\", name: \"English\" }];\n        }\n\n    }\n\n    function getSelectedLanguage() {\n\n        var languages = getLanguages();\n        var language = StorageService.get(\"language\");\n\n        // Only return if the value is valid.\n        language = _.findWhere(languages, { code: language });\n        if (language) {\n            return language;\n        }\n\n        // Return empty.\n        return { name: null, code: null };\n\n    }\n\n    function isSupportedLanguage(language) {\n\n        var languages = getLanguages();\n        return !(_.findWhere(languages, { code: language }) == null);\n\n    }\n\n    function setLanguage(language, languagesPath) {\n\n        // Only attempt to set the language if the supplied value is valid.\n        if (isSupportedLanguage(language) == false) {\n            return;\n        }\n\n        if (language != null) {\n            StorageService.set(\"language\", language);\n            gettextCatalog.setCurrentLanguage(language);\n\n            // Emit the change\n            $rootScope.$emit(\"languageChanged\", language);\n\n            // English does not need to be loaded since it's embedded in the HTML.\n            if (language != \"en\") {\n                // Load the language configuration file.\n                gettextCatalog.loadRemote((languagesPath || \"languages/\") + language + \"/\" + language + \".json\");\n            }\n        }\n\n    }\n\n    function getUserLanguage() {\n\n        var deferred = $q.defer();\n\n        // Check if languages are provided. If not, just return english and don't bother fetching the user's language from the server.\n        if (!$rootScope.languages) {\n            deferred.resolve(\"en\");\n            return deferred.promise;\n        }\n\n        // If a language is already set and it's valid, just return that language.\n        var language = getSelectedLanguage();\n\n        if (language.code) {\n\n            // We already have a language set, return it.\n            deferred.resolve(language.code);\n\n        } else {\n\n            // Determine the user's language from the server, which is the most reliable way to get browser language settings into JavaScript.\n            var settings = SettingsService.get();\n            ApiService.getItem(\"/browser_info\", null, true).then(function (response) {\n\n                // The value returned in language will either be a valid two-character language code or null.\n                deferred.resolve(response.data.language);\n\n            }, function (error) {\n                // We always resolve the promise, just with null in the case of error.\n                deferred.resolve(null);\n            });\n\n        }\n\n        return deferred.promise;\n\n    }\n\n    function establishLanguage(languagesPath) {\n\n        // This called when the app is intially bootstrapped and sets the language according to the user's preference, auto-detected language or default language.\n        getUserLanguage().then(function (language) {\n\n            // If null, set the default\n            if (language == null) {\n                language = \"en\";\n            }\n\n            // Set the language\n            setLanguage(language, languagesPath);\n\n        });\n\n    }\n\n}]);\n\napp.service(\"SettingsService\", [function ($http, $q) {\n\n    // Return public API.\n    return {\n        get: get\n    };\n\n    function get() {\n\n        // The embedded settings/app.js and settings/account.js set the values within the __settings global variable.\n\n        // Get account settings\n        var getAccountSettings = function () {\n\n            var accountSettings = {};\n\n            if (window.__settings) {\n                if (window.__settings.account) {\n                    accountSettings = window.__settings.account;\n                }\n            }\n\n            // If accountSettings doesn't have the property \"date_utc\", inject the current client-side date.\n            // The purpose is to provide the current server date to the app when running in the hosted environment. It is not designed to give precise time (because the settings file may be cached for minutes) \n            // Therefore, it always returns a date with the time at midnight, but will provide a reliable date \"seed\" in the application for things like credit card expiration date lists and copyright dates. Useful when you don't want to rely on a client-side clock.\n            if (!accountSettings.date_utc) {\n                // No value provided in the settings file, which is likely in development environments. Inject the client-side date so the app doesn't have to consider null values.\n                accountSettings.date_utc = utils.getCurrentIsoDate(true);\n            }\n\n            // Split the date into parts for easy access\n            var date = new Date(accountSettings.date_utc);\n            accountSettings.year = date.getFullYear();\n            accountSettings.month = date.getMonth();\n            accountSettings.date = date.getDate();\n\n            return accountSettings;\n        };\n\n        // Get app settings\n        var getAppSettings = function () {\n\n            var appSettings = {};\n\n            if (window.__settings) {\n                if (window.__settings.app) {\n                    appSettings = window.__settings.app;\n                }\n            }\n\n            return appSettings;\n        };\n\n        // Build and return the settings object\n        var settings = { account: getAccountSettings(), app: getAppSettings(), config: {} };\n\n        // Define the api prefix\n        settings.config.apiPrefix = \"/api/v1\";\n\n        settings.config.development = false;\n\n        // For convenience, if you place a development flag in either one of the settings stubs (during local development), the app will be marked as running in development mode.\n        if (settings.account.development || settings.app.development) {\n\n            settings.config.development = true;\n\n            // Make the apiPrefix a fully qualified url since requests in development mode don't have access to the reverse proxy.\n            settings.config.apiPrefix = \"https://api.comecero.com\" + settings.config.apiPrefix;\n        }\n\n        return settings;\n\n    }\n\n}]);\n\napp.service(\"HelperService\", ['SettingsService', 'StorageService', '$location', function (SettingsService, StorageService, $location) {\n\n    // Return public API.\n    return {\n        isRequiredCustomerField: isRequiredCustomerField,\n        isOptionalCustomerField: isOptionalCustomerField,\n        isCustomerField: isCustomerField,\n        hasShippingAddress: hasShippingAddress,\n        newSessionRedirect: newSessionRedirect,\n        getShoppingUrl: getShoppingUrl,\n        hasSubscription: hasSubscription,\n        hasPhysical: hasPhysical,\n        supportsPaymentMethod: supportsPaymentMethod\n    };\n\n    function isRequiredCustomerField(field, options, shippingIsBilling) {\n\n        if (!field || !options) {\n            return false;\n        }\n\n        // If shippingIsBilling == false and the field is a shipping address, swap shipping_address in the field name with billing_address before you compare.\n        var isShippingField = false;\n        if (field.substring(0, 17) == \"shipping_address.\") {\n            field = \"billing_address.\" + field.substring(17);\n            isShippingField = true;\n        }\n\n        if (field == \"billing_address.name\") {\n            field = \"name\";\n        }\n\n        if (shippingIsBilling === true) {\n            return false;\n        }\n\n        if (!options.customer_required_fields) {\n            return false;\n        }\n\n        if (options.customer_required_fields.indexOf(field) >= 0) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n    function isOptionalCustomerField(field, options, shippingIsBilling) {\n\n        if (!field || !options) {\n            return false;\n        }\n\n        // If shippingIsBilling == false and the field is a shipping address, swap shipping_address in the field name with billing_address before you compare.\n        var isShippingField = false;\n        if (field.substring(0, 17) == \"shipping_address.\") {\n            field = \"billing_address.\" + field.substring(17);\n            isShippingField = true;\n        }\n        if (field == \"billing_address.name\") {\n            field = \"name\";\n        }\n\n        if (shippingIsBilling === true) {\n            return false;\n        }\n\n        if (!options.customer_optional_fields) {\n            return false;\n        }\n\n        if (options.customer_optional_fields.indexOf(field) >= 0) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n    function isCustomerField(field, options, shippingIsBilling) {\n\n        if (!field || !options) {\n            return false;\n        }\n\n        if (options.customer_required_fields) {\n            if (isRequiredCustomerField(field, options, shippingIsBilling)) {\n                return true;\n            }\n        }\n\n        if (options.customer_optional_fields) {\n            if (isOptionalCustomerField(field, options, shippingIsBilling)) {\n                return true;\n            }\n        }\n\n        return false;\n\n    }\n\n    function hasShippingAddress(customer) {\n\n        if (customer) {\n            if (customer.shipping_address) {\n                if (customer.shipping_address.address_1) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n\n    }\n\n    function newSessionRedirect(reset, debug) {\n\n        // This redirects the user to the base location of a new session, which may be an external URL.\n        // If reset == true, then it flushes the cart_id and token before performing the redirect.\n\n        // In the case of a bad token, invalid cart id or other unfortunate situation, this resets the user's session and redirects them to the desired URL.\n\n        console.log(debug);\n\n        if (reset === true) {\n            StorageService.remove(\"cart_id\");\n            StorageService.remove(\"invoice_id\");\n            StorageService.remove(\"token\");\n        }\n\n        var settings = SettingsService.get().app;\n\n        if (settings.main_shopping_url) {\n\n            // If a main shopping URL has been provided, redirect to it.\n            window.location.replace(settings.main_shopping_url);\n\n        } else {\n\n            // Otherwise, redirect to the app root. If the destination is the same page they're on, the location.replace won't do anything. Reload the current page in that case.\n            if ($location.path() != \"/\") {\n                $location.path(\"/\");\n                $location.replace();\n            } else {\n                window.location.reload();\n            }\n\n        }\n    }\n\n    function getShoppingUrl() {\n\n        var settings = SettingsService.get().app;\n\n        if (settings.main_shopping_url == null) {\n            return window.location.href.substring(0, window.location.href.indexOf(\"#\")) + \"#/\";\n        } else {\n            return settings.main_shopping_url;\n        }\n\n    }\n\n    function hasSubscription(items) {\n\n        if (_.find(items, function (item) { return item.subscription_plan != null; }) != null) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n    function hasPhysical(items) {\n\n        if (_.find(items, function (item) { return item.type == \"physical\"; }) != null) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n    function supportsPaymentMethod(type, options) {\n\n        if (!type || !options) {\n            return false;\n        }\n\n        if (_.find(options.payment_methods, function (item) { return item.payment_method_type == type; }) != null) {\n            return true;\n        }\n\n        return false;\n\n    }\n\n}]);\n\napp.service(\"StorageService\", ['appCache', function (appCache) {\n\n    // Return public API.\n    return {\n        get: get,\n        set: set,\n        remove: remove\n    };\n\n    function get(key) {\n\n        var value = appCache.get(key);\n\n        if (value == null) {\n            // Look to to cookie for a backup\n            value = utils.getCookie(key);\n        }\n\n        return value;\n\n    }\n\n    function set(key, value, expiresInSeconds) {\n\n        appCache.put(key, value);\n\n        // If expiresInSeconds is not defined, we'll use 14 days as the default\n        if (expiresInSeconds == null) {\n            expiresInSeconds = 1209600;\n        }\n\n        // Backup to a cookie\n        utils.setCookie(key, value, expiresInSeconds / 60);\n\n    }\n\n    function remove(key) {\n\n        appCache.remove(key);\n\n        // Remove the associated cookie\n        utils.deleteCookie(key);\n\n    }\n\n}]);\n\n\napp.controller(\"SettingsController\", function($scope, SettingsService) {\n  $scope.settings = SettingsService.get();\n});\n\napp.controller(\"TimezonesController\", function($scope, TimezonesService) {\n  $scope.timezones = TimezonesService.getTimezones();\n});\n\napp.controller(\"RootController\",\n  function ($scope, ApiService, $q, toCSV, saveFile, buildRootUrl, fetchData, SettingsService) {\n    var settings = SettingsService.get();\n    if (angular.isUndefined(settings.app.timezone) || settings.app.timezone.length <= 0)\n      settings.app.timezone = 'UTC';\n    if (angular.isUndefined(settings.app.exportFormat) || settings.app.exportFormat.length <= 0)\n      settings.app.exportFormat = 'csv';\n    if (angular.isUndefined(settings.app.dates) || settings.app.dates.length <= 0)\n      settings.app.dates = 'last_30';\n    if (angular.isUndefined(settings.app.dataset) || settings.app.dataset.length <= 0)\n      settings.app.dataset = 'orders';\n\n    // Set defaults\n    $scope.options = {\n      dataset: settings.app.dataset,\n      format: settings.app.exportFormat,\n      timezone: settings.app.timezone,\n      dates: settings.app.dates,\n      unravelFields: [{id: 'items', name: 'Items'}],\n      unravelField: 'items'\n    };\n    $scope.datepicker = {\n      status: {\n        date_start: {opened: false},\n        date_end: {opened: false}\n      },\n      options: {\n        startingDay: 1,\n        showWeeks: false,\n        initDate: new Date(),\n        yearRange: 10\n      },\n      open: function ($event, which) {\n        $scope.datepicker.status[which].opened = true;\n      }\n    };\n\n    var _cancel = function() {\n      if (angular.isFunction($scope.cancelFunc)) {\n        $scope.cancelFunc();\n        $scope.cancelFunc = undefined;\n        return true;\n      }\n      return false;\n    }\n\n    var _export = function(options, datepicker) {\n      fetchData($scope, options, datepicker).then(function(data) {\n        if (!angular.isArray(data) || data.length <= 0) {\n          $scope.error = {message: 'No results found'};\n          return;\n        }\n\n        var formatted;\n        var type = 'text/' + options.format;\n        switch (options.format) {\n          case 'csv':\n            formatted = toCSV(data, options);\n            break;\n          case 'json':\n            formatted = JSON.stringify(data, function(key, value) {return value;}, new Number(2));\n            break;\n          default:\n            $scope.error = {message: 'Unknown export format'};\n            return;\n        };\n\n        var date_range = options.dates;\n        if (date_range == 'custom') {\n          date_range = datepicker.date_start.toISOString().substring(0, 10) + '_to_' +\n            datepicker.date_end.toISOString().substring(0, 10);\n        }\n\n        var fileName = options.dataset;\n        if (angular.isDefined(options.status) && options.status.length > 0) fileName += '_' + options.status;\n        fileName += '_' + date_range + '.' + options.format;\n        saveFile(fileName, type, formatted);\n        $scope.successMessage = 'Export successful';\n      }, function(error) {\n        $scope.error = error;\n        _cancel();\n      });\n    };\n\n    $scope.export = function() {\n      $scope.clearMessages();\n      _export(angular.copy($scope.options),angular.copy($scope.datepicker));\n    };\n\n    $scope.cancel = function() {\n      if (_cancel()) {\n        $scope.successMessage = 'Canceled export.';\n      }\n    }\n\n    $scope.clearMessages = function() {\n      $scope.successMessage = '';\n      $scope.error = {};\n    };\n});\n"],"file":"data-export.js"}