/*
Comecero Data Export version: 0.9.2
https://comecero.com
https://github.com/comecero/data-export
Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

app.controller("SettingsController",function(e,t){e.settings=t.get()}),app.controller("TimezonesController",function(e,t){e.timezones=t.getTimezones()}),app.controller("RootController",function(e,t,n,s,r,a,o){e.options={dataset:"orders",format:"csv",timezone:"UTC",dates:"last_30",unravelFields:[{id:"items",name:"Items"}],unravelField:"items"},e.datepicker={status:{date_start:{opened:!1},date_end:{opened:!1}},options:{startingDay:1,showWeeks:!1,initDate:new Date,yearRange:10},open:function(t,n){e.datepicker.status[n].opened=!0}};var c=function(){return!!angular.isFunction(e.cancelFunc)&&(e.cancelFunc(),e.cancelFunc=void 0,!0)},i=function(t,n){o(e,t,n).then(function(a){if(!angular.isArray(a)||a.length<=0)return void(e.error={message:"No results found"});var o,c="text/"+t.format;switch(t.format){case"csv":o=s(a,t);break;case"json":o=JSON.stringify(a,function(e,t){return t},new Number(2));break;default:return void(e.error={message:"Unknown export format"})}var i=t.dates;"custom"==i&&(i=n.date_start.toISOString().substring(0,10)+"_to_"+n.date_end.toISOString().substring(0,10));var u=t.dataset;angular.isDefined(t.status)&&t.status.length>0&&(u+="_"+t.status),u+="_"+i+"."+t.format,r(u,c,o),e.successMessage="Export successful"},function(t){e.error=t,c()})};e.export=function(){e.clearMessages(),i(angular.copy(e.options),angular.copy(e.datepicker))},e.cancel=function(){c()&&(e.successMessage="Canceled export.")},e.clearMessages=function(){e.successMessage="",e.error={}}});